---
title: "Broadband as a Social Sensor Code"
author: "Nikki Ritsch"
date: "12/05/2022"
---
#Importing Key Libraries
```{r}

library("tidycensus")
library("readxl")
library("writexl")
library("tidyverse")
library("tidyr")
library("dplyr")
library("data.table")
library("tigris")
library("plyr")
library("stargazer")
library("gtsummary")
library("labelled")
library("survival")
library("MatchIt")
library("lmtest")
library("cem")
library("miceadds")
library("estimatr")
library("gsynth")
library("panelView")
library("vtable")
library("car")
library("corrtable")
library("webshot2")
library("devtools")
library("SciViews")
```

#Importing all Data 
References: 
R package and documentation: https://cran.r-project.org/web/packages/tidycensus/tidycensus.pdf
TIGER-Lines: https://cran.r-project.org/web/packages/tigris/tigris.pdf

```{r}

#2020 FIPS Counties - 3135 TOTAL

#Uploading my API Key
census_api_key("5e5b54ac9944e13c844371b8a790c75191539625", overwrite = FALSE, install = FALSE)

#Pulling the list of FIPS Codes from Census ("This data set includes FIPS codes for all counties that have appeared in the decennial Census or American Community Survey from 2010 to the present. This means that counties that have been renamed or absorbed into other geographic entities since 2010 remain in this data set, along with newly added or renamed counties." So we will use as the base, but then refine based off of 2020 update.)
data(fips_codes)

#Concatenating GEOID from state and county FIPs codes
fips_codes$GEOID <- str_c(fips_codes$state_code,"", fips_codes$county_code)

#Adding combined name for county with state 
fips_codes$'Combined Name' <- str_c(fips_codes$county,", ", fips_codes$state_name)

#Pulling the list of FIPS Codes from Census for 2020, based off of TIGER Line Files 
counties_2020 <- counties(year=2020)

#Just keeping GEOID
counties_2020_short <- counties_2020$GEOID
counties_2020_short <- read.table(text=counties_2020_short,col.names=c('GEOID'))
#Making all GEOIDs 5 digits long 
counties_2020_short$GEOID <- sprintf("%05d", counties_2020_short$GEOID)

#FINAL LIST OF FIPS COUNTIES for 2020 - 3234 Counties (including territories)
fips_counties_2020 <- merge(counties_2020_short, fips_codes, by.x="GEOID", by.y="GEOID", all.x=TRUE)

#Dropping U.S. territories due to lack of data across all data sets 

#Removing American Somoa
drops<-which(grepl("AS", fips_counties_2020$state))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing Guam
drops<-which(grepl("GU", fips_counties_2020$state))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing Northern Mariana Islands
drops<-which(grepl("MP", fips_counties_2020$state))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing Puerto Rico
drops<-which(grepl("PR", fips_counties_2020$state))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing Virgin Islands
drops<-which(grepl("VI", fips_counties_2020$state))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Final county subset has 3143 counties for contiguous US (confirmed by census https://www.census.gov/library/stories/2021/08/more-than-half-of-united-states-counties-were-smaller-in-2020-than-in-2010.html)

#Note: no unemployment data for 02063, 02066, and 15005. So we drop them from the whole data set.

#Removing County 02063 (Chugach Census Area, AK)
drops<-which(grepl("02063", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing County 02066 (Copper River Census Area, AK)
drops<-which(grepl("02066", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing County 15005 (Kalawao County, HI)
drops<-which(grepl("15005", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Note: no demographic data for 02195, 22059, and 35013. So we drop them from the whole data set as well.

#Removing County 02195 (Petersburg Census Area, Alaska)
drops<-which(grepl("02195", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing County 22059 (La Salle Parish, Louisiana)
drops<-which(grepl("22059", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing County 35013 (Dona Ana County, New Mexico)
drops<-which(grepl("35013", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Note: no education data for 02158 and 46102. So we drop as well. 

#Removing County 02158 (Kusilvak Census Area, Alaska)
drops<-which(grepl("02158", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Removing County 46102 (Oglala Lakota County, South Dakota)
drops<-which(grepl("46102", fips_counties_2020$GEOID))
fips_counties_2020 <-fips_counties_2020[-c(drops),]

#Total = 3135 counties. 

#Dropping unnecessary data sets
rm(counties_2020)
rm(counties_2020_short)
rm(fips_codes)

#2019 and 2020 Demographic Data

#Loading Census Variable List for ACS 5-year estimates 
#census_variable_list_ACS_2019 <- load_variables(2019, "acs5", cache = FALSE)
#census_variable_list_ACS_2010 <- load_variables(2010, "acs5", cache = FALSE)
#census_variable_list_Decadal <- load_variables(2020, "pl", cache = FALSE)

#According to US Census, okay to compare to decadal estimates to ACS 5-year estimates, but not ACS 5-year overlapping windows (https://www.census.gov/programs-surveys/acs/guidance/comparing-acs-data.html). So we will use ACS 5-year estimates for 2019 data and the decadal survey for the 2020 data. 

#Populations for 2019 (ACS) and 2020 (Decadal)
demo_county_2019 <- get_acs(
                      geography ="county",
                      year=2019,
                      variables=c(pop_tot="B01003_001E", 
                                  pop_white = "B02001_002E",
                                  pop_black="B02001_003E",
                                  pop_amerind="B02001_004E",
                                  pop_asian="B02001_005E",
                                  pop_hispanic = "B03002_012E"),
                      geometry = FALSE,
                      output = "wide") %>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data 

demo_county_2019$percent_black <-demo_county_2019$pop_black/demo_county_2019$pop_tot
demo_county_2019$percent_natamerican <-demo_county_2019$pop_amerind/demo_county_2019$pop_tot
demo_county_2019$percent_asian <-demo_county_2019$pop_asian/demo_county_2019$pop_tot
demo_county_2019$percent_hispanic <-demo_county_2019$pop_hispanic/demo_county_2019$pop_tot
demo_county_2019$log_pop_density <- log(demo_county_2019$pop_tot)

demo_county_2019 <- merge(fips_counties_2020, demo_county_2019, by.x=c("GEOID", "Combined Name"), by.y=c("GEOID","NAME"), all.x=TRUE)

demo_county_2020 <- get_decennial(
                      geography ="county",
                      year=2020,
                      variables=c(pop_tot="P1_001N", 
                                  pop_white = "P1_003N",
                                  pop_black="P1_004N",
                                  pop_amerind="P1_005N",
                                  pop_asian="P1_006N",
                                  pop_hispanic = "P2_002N"),
                      geometry = FALSE,
                      output = "wide")

demo_county_2020$percent_black <-demo_county_2020$pop_black/demo_county_2020$pop_tot
demo_county_2020$percent_natamerican <-demo_county_2020$pop_amerind/demo_county_2020$pop_tot
demo_county_2020$percent_asian <-demo_county_2020$pop_asian/demo_county_2020$pop_tot
demo_county_2020$percent_hispanic <-demo_county_2020$pop_hispanic/demo_county_2020$pop_tot
demo_county_2020$log_pop_density <- log(demo_county_2020$pop_tot)

demo_county_2020$Black_Below_0_Above_1 <- ifelse(demo_county_2020$percent_black >= median(demo_county_2020$percent_black), 1, 0)

demo_county_2020$Hispanic_Below_0_Above_1 <- ifelse(demo_county_2020$percent_hispanic >= median(demo_county_2020$percent_hispanic), 1, 0)

keeps <- c("GEOID", "Black_Below_0_Above_1", "Hispanic_Below_0_Above_1")
demo_county_2020_splits = demo_county_2020[keeps]

#We use the 2020 data to create the splits for the Black and Hispanic populations so we merge the binary variable from 2020 with the 2019 data 
demo_county_2019 <- merge(demo_county_2019, demo_county_2020_splits, by.x="GEOID", by.y="GEOID", all.x=TRUE)

demo_county_2020 <- merge(fips_counties_2020, demo_county_2020, by.x=c("GEOID", "Combined Name"), by.y=c("GEOID","NAME"), all.x=TRUE)

#Population Density (not a variable provided by census - pulled from GIS)
pop_density <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/PopDensity.xlsx")

#Education rates and density 
ed_county_2019 <- get_acs(
                      geography ="county",
                      year=2019,
                      variables=c(bs_or_more="B15003_022E",
                                  ms_or_more="B15003_023E",
                                  professional_or_more="B15003_024E",
                                  phd="B15003_025E"),
                      geometry = FALSE,
                      output = "wide") %>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data 

ed_county_2019$ed_25up_BSup_2019 <- ed_county_2019$bs_or_more + ed_county_2019$ms_or_more + ed_county_2019$professional_or_more + ed_county_2019$phd

keeps <- c("GEOID", "ed_25up_BSup_2019")
ed_county_2019 = ed_county_2019[keeps]

ed_county_2010 <- get_acs(
                      geography ="county",
                      year=2010,
                      variables=c(bs_or_more_male="B15002_015",
                                  bs_or_more_female="B15002_032",
                                  ms_or_more_male="B15002_016",
                                  ms_or_more_female="B15002_033",
                                  professional_or_more_male="B15002_017",
                                  professional_or_more_female="B15002_034",
                                  phd_male="B15002_018",
                                  phd_female="B15002_035"),
                      geometry = FALSE,
                      output = "wide") %>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data 

ed_county_2010$ed_25up_BSup_2010 <- ed_county_2010$bs_or_more_maleE + ed_county_2010$bs_or_more_femaleE + ed_county_2010$ms_or_more_maleE + ed_county_2010$ms_or_more_femaleE + ed_county_2010$professional_or_more_maleE + ed_county_2010$professional_or_more_femaleE + ed_county_2010$phd_maleE + ed_county_2010$phd_femaleE

keeps <- c("GEOID", "ed_25up_BSup_2010")
ed_county_2010 = ed_county_2010[keeps]

education <- merge(ed_county_2010, ed_county_2019, by.x="GEOID",by.y="GEOID", all.x=TRUE)

education <- merge(demo_county_2019, education, by.x="GEOID",by.y="GEOID", all.x=TRUE)

education$ed_growth_rate <- (education$ed_25up_BSup_2019-education$ed_25up_BSup_2010)/education$ed_25up_BSup_2010

education$percent_ed <- education$ed_25up_BSup_2019/education$pop_tot

keeps <- c("GEOID", "ed_growth_rate", "percent_ed")
education = education[keeps]

rm(ed_county_2019)
rm(ed_county_2010)

#2019 and 2020 Other Data

##Broadband

### MSFT 2019 
#Source: MSFT GitHub - https://github.com/microsoft/USBroadbandUsagePercentages/tree/master/dataset
bb_2019_clean <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Broadband/broadband_data_2019November.xlsx")

### MSFT 2020 and FCC 2019 
#Source: MSFT GitHub - https://github.com/microsoft/USBroadbandUsagePercentages/tree/master/dataset
bb_2020_clean <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Broadband/broadband_data_2020October.xlsx")

#ACS, Ookla and MLab 2020 at County
#Source: Indicators of Broadband Need - https://broadbandusa.ntia.doc.gov/resources/data-and-mapping
bb_ACS_Ookla_Mlab_2020 <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Broadband/IBNCounties_Cleaned_ACS_Ookla_Mlab.xlsx")

#ACS, FCC and Ookla at CT 
#Source:Indicators of Broadband Need - https://broadbandusa.ntia.doc.gov/resources/data-and-mapping
bb_2020_censustract_IBN <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Broadband/IBNTracts_Cleaned_ACS_FCC_Ookla.xlsx")

bb <- merge(bb_2019_clean, bb_2020_clean, by.x=c("COUNTY_ID", "ST", "COUNTY_NAME") ,by.y=c("COUNTY_ID", "ST", "COUNTY_NAME"), all.x=TRUE)

bb <- merge(bb, bb_ACS_Ookla_Mlab_2020, by.x="COUNTY_ID", by.y="GEOID_County", all.x=TRUE)

bb <- merge(demo_county_2019, bb, by.x="GEOID", by.y="COUNTY_ID", all.x=TRUE)

keeps <- c("GEOID", "bb_MSFT_Nov2019", "bb_MSFT_Oct2020", "bb_FCC_2019_AnnualReport", "bb_ACS_2020", "bb_Ookla_2020_download", "bb_Mlab_2020_download")
bb = bb[keeps]

bb$msft_75_or_more_2019 <- ifelse(bb$bb_MSFT_Nov2019 >= .75, 1, 0)

bb$msft_50_or_more_2019 <- ifelse(bb$bb_MSFT_Nov2019 >= .50, 1, 0)

bb$msft_40_or_more_2019 <- ifelse(bb$bb_MSFT_Nov2019 >= .40, 1, 0)

bb$msft_25_or_more_2019 <- ifelse(bb$bb_MSFT_Nov2019 >= .25, 1, 0)

bb$msft_75_or_more_2020 <- ifelse(bb$bb_MSFT_Oct2020 >= .75, 1, 0)

bb$msft_50_or_more_2020 <- ifelse(bb$bb_MSFT_Oct2020 >= .50, 1, 0)

bb$msft_40_or_more_2020 <- ifelse(bb$bb_MSFT_Oct2020 >= .40, 1, 0)

bb$msft_25_or_more_2020 <- ifelse(bb$bb_MSFT_Oct2020 >= .25, 1, 0)

bb$fcc_75_or_more_2019 <- ifelse(bb$bb_FCC_2019_AnnualReport >= .75, 1, 0)

bb$fcc_50_or_more_2019 <- ifelse(bb$bb_FCC_2019_AnnualReport >= .50, 1, 0)

bb$fcc_40_or_more_2019 <- ifelse(bb$bb_FCC_2019_AnnualReport >= .40, 1, 0)

bb$fcc_25_or_more_2019 <- ifelse(bb$bb_FCC_2019_AnnualReport >= .25, 1, 0)

bb$acs_75_or_more_2020 <- ifelse(bb$bb_ACS_2020 >= .75, 1, 0)

bb$acs_50_or_more_2020 <- ifelse(bb$bb_ACS_2020 >= .50, 1, 0)

bb$acs_40_or_more_2020 <- ifelse(bb$bb_ACS_2020 >= .40, 1, 0)

bb$acs_25_or_more_2020 <- ifelse(bb$bb_ACS_2020 >= .25, 1, 0)

#Only gives average speed throughout county so cannot do anything with penetration
bb$ookla_50_or_more_2020 <- ifelse(bb$bb_Ookla_2020_download >= 25, 1, 0)

#Only gives average speed throughout county so cannot do anything with penetration
bb$mlab_50_or_more_2020 <- ifelse(bb$bb_Mlab_2020_download>= 25, 1, 0)

### Checking that MSFT Treatments Don't Change
bb$MSFT_nonchange_25 <- ifelse(bb$msft_25_or_more_2020 - bb$msft_25_or_more_2019 == 0, 1, 0)

bb$MSFT_nonchange_40 <- ifelse(bb$msft_40_or_more_2020 - bb$msft_40_or_more_2019 == 0, 1, 0)

bb$MSFT_nonchange_50 <- ifelse(bb$msft_50_or_more_2020 - bb$msft_50_or_more_2019 == 0, 1, 0)

bb$MSFT_nonchange_75 <- ifelse(bb$msft_75_or_more_2020 - bb$msft_25_or_more_2019 == 0, 1, 0)

rm(bb_2019_clean)
rm(bb_2020_clean)
rm(bb_ACS_Ookla_Mlab_2020)

##Labor Area Unemployment Statistics 

#Source: Data pulled directly from LAUS data tables (https://www.bls.gov/lau/tables.htm in conjunction with WayBackMachine to pull county-level month by month data back as far as was needed)

#Note no data for 02063, 02066, and 15005. So we drop them from the whole data set. 

LAU_employment_2019Julyto2019Dec <-read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Employment/LAU_County_Jul2019Dec2019.xlsx")

LAU_employment_2019Julyto2019Dec <- merge(demo_county_2019, LAU_employment_2019Julyto2019Dec,  by.x="GEOID", by.y="GEOID", all.x=TRUE)

LAU_employment_2020Janto2020Oct <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Employment/LAU_County_Jan2020Oct2020.xlsx")

LAU_employment_2020Janto2020Oct <- merge(demo_county_2020, LAU_employment_2020Janto2020Oct,  by.x="GEOID", by.y="GEOID", all.x=TRUE)

LAU_employment_2019Julyto2020Oct <- rbind(LAU_employment_2019Julyto2019Dec, LAU_employment_2020Janto2020Oct)

rm(LAU_employment_2019Julyto2019Dec)
rm(LAU_employment_2020Janto2020Oct)

##Urban vs Rural
#Based off of the 2010 Census. Counties with less than 50 percent of the population living in rural areas are classified as mostly urban; 50 to 99.9 percent are classified as mostly rural; 100 percent rural are classified as completely rural. For the standard boolean, 1 = Mostly Urban, 0 = Mostly rural + completely rural. 
#Source: U.S. Census Bureau, 2010 Census, Summary File 1, Table P2.

county_ruralurban <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/UrbanRural/County_Rural_Urban_2010.xlsx")

county_ruralurban <- merge(county_ruralurban, fips_counties_2020, by.x="GEOID", by.y="GEOID", all.y = TRUE)

keeps <- c("GEOID", "Urban_1_Rural_0")
county_ruralurban = county_ruralurban[keeps]

## Income 

#High-income vs Low-income
#Note the variable pulled here defines "2019 Median Household Income (ACS 5-Yr)"

county_income<- get_acs(
                      geography ="county",
                      year=2019,
                      variables=c(hh_income="B19013_001E"),
                      geometry = FALSE,
                      output = "wide") %>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data 

county_income <- merge(county_income, fips_counties_2020, by.x="GEOID", by.y="GEOID", all.y = TRUE)

county_income$income_below_0_above_1 <- ifelse(county_income$hh_income >= median(county_income$hh_income), 1, 0)

keeps <- c("GEOID", "income_below_0_above_1")
county_income = county_income[keeps]

##EID

#Essential Industry Designation 
#Source: Used the definition from United Way which was one of the most accessible datasets at the time of analysis (https://unitedwaynca.org/blog/us-states-with-the-most-essential-workers/)

EID_state <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/EID/Percent Essential Workers.xlsx")

keeps <- c("State_GEOID", "PercentEssential_BelowMedian_0_AboveMedian_1")
EID_state = EID_state[keeps]

##Services !!CHECK!!
#Source: Data pulled directly

county_services <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Service/Service_Sector_All_Counties_2021Q1.xlsx")

county_services_sum <- ddply(county_services,.(GEOID),summarize,Employ_Services=sum(Emp_2020Q1))

county_services_sum$GEOID <- sprintf("%05d", county_services_sum$GEOID)

county_services_sum_perpop <- merge(county_services_sum, demo_county_2019, by.x="GEOID", by.y="GEOID", all.y=TRUE)

county_services_sum_perpop$Employ_Services_perpop <- county_services_sum_perpop$Employ_Services/county_services_sum_perpop$pop_tot

#Because pulling from QCEW only includes counties with workers, need to fill in misisng counties 

keeps <- c("GEOID", "Employ_Services_perpop")
county_services_sum_perpop = county_services_sum_perpop[keeps]

county_services_sum_perpop[is.na(county_services_sum_perpop)] <- 0

county_services_sum_perpop$Services_Below_0_Above_1 <- ifelse(county_services_sum_perpop$Employ_Services_perpop >= median(county_services_sum_perpop$Employ_Services_perpop), 1, 0)

keeps <- c("GEOID", "Services_Below_0_Above_1")
county_services = county_services_sum_perpop[keeps]

rm(county_services_sum)
rm(county_services_sum_perpop)

##Tech

#Source: Collected from QWI 
# Tech Industry as defined by NSF in Science and Engineering Indicators 2014 (https://www.nsf.gov/statistics/seind14/index.cfm/chapter-8/tt08-a.htm)
#Note different data used for Q1 2020: Alaska (Q2 2016), Arkansas (Q2 2018) and Mississippi (Q2 2018)

AK_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/AK_HighTech.xlsx")

AL_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/AL_HighTech.xlsx")

AZ_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/AZ_HighTech.xlsx")

AR_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/AR_HighTech.xlsx")

CA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/CA_HighTech.xlsx")

CO_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/CO_HighTech.xlsx")

CT_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/CT_HighTech.xlsx")

DE_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/DE_HighTech.xlsx")

DC_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/DC_HighTech.xlsx")

FL_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/FL_HighTech.xlsx")

GA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/GA_HighTech.xlsx")

HI_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/HI_HighTech.xlsx")

ID_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/ID_HighTech.xlsx")

IL_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/IL_HighTech.xlsx")

IN_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/IN_HighTech.xlsx")

IA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/IA_HighTech.xlsx")

KS_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/KS_HighTech.xlsx")

KY_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/KY_HighTech.xlsx")

LA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/LA_HighTech.xlsx")

ME_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/ME_HighTech.xlsx")

MD_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MD_HighTech.xlsx")

MA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MA_HighTech.xlsx")

MI_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MI_HighTech.xlsx")

MN_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MN_HighTech.xlsx")

MS_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MS_HighTech.xlsx")

MO_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MO_HighTech.xlsx")

MT_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/MT_HighTech.xlsx")

NE_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NE_HighTech.xlsx")

NV_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NV_HighTech.xlsx")

NH_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NH_HighTech.xlsx")

NJ_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NJ_HighTech.xlsx")

NM_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NM_HighTech.xlsx")

NY_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NY_HighTech.xlsx")

NC_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/NC_HighTech.xlsx")

ND_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/ND_HighTech.xlsx")

OH_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/OH_HighTech.xlsx")

OK_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/OK_HighTech.xlsx")

OR_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/OR_HighTech.xlsx")

PA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/PA_HighTech.xlsx")

RI_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/RI_HighTech.xlsx")

SC_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/SC_HighTech.xlsx")

SD_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/SD_HighTech.xlsx")

TN_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/TN_HighTech.xlsx")

TX_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/TX_HighTech.xlsx")

UT_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/UT_HighTech.xlsx")

VT_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/VT_HighTech.xlsx")

VA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/VA_HighTech.xlsx")

WA_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/WA_HighTech.xlsx")

WV_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/WV_HighTech.xlsx")

WY_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/WY_HighTech.xlsx")

WI_HighTech <- read_excel("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Demographics/Tech/WY_HighTech.xlsx")

county_HighTech_total <- rbind(AL_HighTech, AK_HighTech, AR_HighTech, AZ_HighTech, CA_HighTech, CO_HighTech, CT_HighTech, DC_HighTech, DE_HighTech, FL_HighTech, GA_HighTech, HI_HighTech, IA_HighTech, ID_HighTech, IL_HighTech, IN_HighTech, KS_HighTech, KY_HighTech, LA_HighTech, MA_HighTech, MD_HighTech, ME_HighTech, MI_HighTech, MN_HighTech, MS_HighTech, MO_HighTech, MT_HighTech, NC_HighTech, ND_HighTech, NE_HighTech, NH_HighTech, NJ_HighTech, NM_HighTech, NV_HighTech, NY_HighTech, OH_HighTech, OK_HighTech, OR_HighTech, PA_HighTech, RI_HighTech, SC_HighTech, SD_HighTech, TN_HighTech, TX_HighTech, UT_HighTech, VA_HighTech, VT_HighTech,UT_HighTech,  WA_HighTech, WI_HighTech, WV_HighTech, WY_HighTech)

county_HighTech_total[is.na(county_HighTech_total)] <- 0

county_HighTech_sum <- county_HighTech_total %>% 
     group_by(geography) %>% 
     summarise_at(vars(Emp),
               list(sum))

county_HighTech_sum_perpop <- merge(demo_county_2019, county_HighTech_sum, by.x="GEOID",  by.y="geography", all.x=TRUE)

county_HighTech_sum_perpop[is.na(county_HighTech_sum_perpop)] <- 0

county_HighTech_sum_perpop$HighTechEmployed_perpop <- county_HighTech_sum_perpop$Emp/county_HighTech_sum_perpop$pop_tot


county_HighTech_sum_perpop$HighTech_Below_0_Above_1 <- ifelse(county_HighTech_sum_perpop$HighTechEmployed_perpop >= median(county_HighTech_sum_perpop$HighTechEmployed_perpop), 1, 0)

keeps <- c("GEOID", "HighTech_Below_0_Above_1")
county_hightech = county_HighTech_sum_perpop[keeps]

rm("AL_HighTech", "AK_HighTech", "AR_HighTech", "AZ_HighTech", "CA_HighTech", "CO_HighTech", "CT_HighTech", "DC_HighTech", "DE_HighTech", "FL_HighTech", "GA_HighTech", "HI_HighTech", "IA_HighTech", "ID_HighTech", "IL_HighTech", "IN_HighTech", "KS_HighTech", "KY_HighTech", "LA_HighTech", "MA_HighTech", "MD_HighTech", "ME_HighTech", "MI_HighTech", "MN_HighTech", "MS_HighTech", "MO_HighTech", "MT_HighTech", "NC_HighTech", "ND_HighTech", "NE_HighTech", "NH_HighTech", "NJ_HighTech", "NM_HighTech", "NV_HighTech", "NY_HighTech", "OH_HighTech", "OK_HighTech", "OR_HighTech", "PA_HighTech", "RI_HighTech", "SC_HighTech", "SD_HighTech", "TN_HighTech", "TX_HighTech", "UT_HighTech", "VA_HighTech", "VT_HighTech", "WA_HighTech", "WI_HighTech", "WV_HighTech", "WY_HighTech")
rm(county_HighTech_sum)
rm(county_HighTech_sum_perpop)
rm(county_HighTech_total)

## Single Parent HH  

#Source: ACS Census
#B11005_006 = Estimate!!Total:!!Households with one or more people under 18 years:!!Family households:!!Other family:!!Male householder, no spouse present
#B11005_007 = Estimate!!Total:!!Households with one or more people under 18 years:!!Family households:!!Other family:!!Female householder, no spouse present

county_parents_per_hh <- get_acs(
                      geography ="county",
                      year=2019,
                      variables=c(hh_tot = "B11005_001",
                                  hh_singleparent_male = "B11005_006", 
                                  hh_singleparent_female = "B11005_007"), 
                      geometry = FALSE,
                      output = "wide")%>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data 

county_parents_per_hh$percent_singleparent <- (county_parents_per_hh$hh_singleparent_femaleE + county_parents_per_hh$hh_singleparent_maleE)/county_parents_per_hh$hh_totE

county_parents_per_hh <- merge(county_parents_per_hh, fips_counties_2020, by.x="GEOID", by.y="GEOID", all.y=TRUE)

county_parents_per_hh$SingleParent_Below_0_Above_1 <- ifelse(county_parents_per_hh$percent_singleparent >= median(county_parents_per_hh$percent_singleparent), 1, 0)

keeps <- c("GEOID", "SingleParent_Below_0_Above_1")
county_parents_per_hh = county_parents_per_hh[keeps]

##Households with Kids 

#Source: ACS 
#B11003_001 = #FAMILY TYPE BY PRESENCE AND AGE OF OWN CHILDREN UNDER 18 YEARS

county_hh_withkids <- get_acs(geography ="county",
                      year=2019,
                      variables=c(hh_tot = "B11005_001",
                                  hh_kidsunder18 = "B11003_001"),
                      geometry = FALSE,
                      output = "wide")%>% 
  select(-ends_with("M")) #To drop the margin of error estimates ACS includes for all data

county_hh_withkids$percent_kidsunder18 <- (county_hh_withkids$hh_kidsunder18E)/county_hh_withkids$hh_totE

county_hh_withkids <- merge(county_hh_withkids, fips_counties_2020, by.x="GEOID", by.y="GEOID", all.y=TRUE)

county_hh_withkids$KidsUnder18_Below_0_Above_1 <- ifelse(county_hh_withkids$percent_kidsunder18 >= median(county_hh_withkids$percent_kidsunder18), 1, 0)

keeps <- c("GEOID", "KidsUnder18_Below_0_Above_1")
county_hh_withkids = county_hh_withkids[keeps]

##Buildings

#Source: US Census Number of New Building Permits per State for June 2022 (https://www.census.gov/construction/bps/statemonthly.html)

state_newbuildings <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Buildings/Census_New Private Housing_June2022_Clean.xlsx")

keeps <- c("State", "NewHouseUnits_Above1_Below0")
state_newbuildings = state_newbuildings[keeps]

##Bridges
#Source: Aggregated from National Bridge Inventory 2020 Data 

bridge_count <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Actual Data/Final Data Set for Nature Version/Bridges/2020_NBI.xlsx")

bridge_count <- bridge_count %>% 
     group_by(FIPS) %>% 
     summarise_at(vars(Count),
               list(sum))

bridge_count <- merge(fips_counties_2020, bridge_count, by.x="GEOID", by.y="FIPS", all.x=TRUE)

bridge_count[is.na(bridge_count)] <- 0

bridge_count$BridgeCount_Above1_Below0 <- ifelse(bridge_count$Count >= median(bridge_count$Count), 1, 0)

keeps <- c("GEOID", "BridgeCount_Above1_Below0")
bridge_count = bridge_count[keeps]

##Compiling Final Dataset

full_df <- merge(LAU_employment_2019Julyto2020Oct, education, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, pop_density, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, bb, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, county_ruralurban, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, county_income, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, EID_state, by.x="state_code", by.y="State_GEOID", all.x=TRUE)
full_df <- merge(full_df, county_services, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, county_hightech, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, county_parents_per_hh, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, county_hh_withkids, by.x="GEOID", by.y="GEOID", all.x=TRUE)
full_df <- merge(full_df, state_newbuildings, by.x="state_name", by.y="State", all.x=TRUE)
full_df <- merge(full_df, bridge_count, by.x="GEOID", by.y="GEOID", all.x=TRUE)

var_label(full_df) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

list("tbl_regression-chr:tidy_columns" = c("estimate", "std.error", "p.value")) %>%
  set_gtsummary_theme()

```

#2019 and 2020 MSFT, LAU Unemployment 

```{r}

ols_2019msft_25_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2019msft_40_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2019msft_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2019msft_75_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2019msft_25_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT**", "**Treat = 40% Penetration, 2019 MSFT**", "**Treat = 50% Penetration, 2019 MSFT**", "**Treat = 75% Penetration, 2019 MSFT**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT", subtitle = "Full Set")

gt::gtsave(tbl_merge_2019_MSFT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT.png")

ols_2020msft_25_unemployment <- lm_robust( Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_40_unemployment <- lm_robust( Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_75_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2020msft_25_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT**", "**Treat = 40% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 75% Penetration, 2020 MSFT**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT", subtitle = "Full Set")

gt::gtsave(tbl_merge_2020_MSFT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT.png")
```

##MSFT, Urban vs Rural, LAU Unemployment 

```{r}
full_df_urban <- full_df[full_df$'Urban_1_Rural_0'== "1",]

var_label(full_df_urban) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_rural <- full_df[full_df$'Urban_1_Rural_0'== "0", ]

var_label(full_df_rural) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#URBAN 2020

ols_2020msft_25_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020msft_40_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020msft_50_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020msft_75_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

tb1 <-
  ols_2020msft_25_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Urban <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Urban**", "**Treat = 40% Penetration, 2020 MSFT Urban**", "**Treat = 50% Penetration, 2020 MSFT Urban**", "**Treat = 75% Penetration, 2020 MSFT Urban**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Urban and Rural", subtitle = "Urban")

gt::gtsave(tbl_merge_2020_MSFT_Urban, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Urban.png")

#RURAL 2020

ols_2020msft_25_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020msft_40_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020msft_50_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020msft_75_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

tb1 <-
  ols_2020msft_25_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Rural <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Rural**", "**Treat = 40% Penetration, 2020 MSFT Rural**", "**Treat = 50% Penetration, 2020 MSFT Rural**", "**Treat = 75% Penetration, 2020 MSFT Rural**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Urban and Rural", subtitle = "Rural")

gt::gtsave(tbl_merge_2020_MSFT_Rural, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Rural.png")

#URBAN 2019

ols_2019msft_25_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019msft_40_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019msft_50_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019msft_75_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

tb1 <-
  ols_2019msft_25_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Urban <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Urban**", "**Treat = 40% Penetration, 2019 MSFT Urban**", "**Treat = 50% Penetration, 2019 MSFT Urban**", "**Treat = 75% Penetration, 2019 MSFT Urban**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Urban and Rural", subtitle = "Urban")

gt::gtsave(tbl_merge_2019_MSFT_Urban, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Urban.png")

#RURAL 2019

ols_2019msft_25_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019msft_40_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019msft_50_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019msft_75_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

tb1 <-
  ols_2019msft_25_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Rural <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Rural**", "**Treat = 40% Penetration, 2019 MSFT Rural**", "**Treat = 50% Penetration, 2019 MSFT Rural**", "**Treat = 75% Penetration, 2019 MSFT Rural**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Urban and Rural", subtitle = "Rural")

gt::gtsave(tbl_merge_2019_MSFT_Rural, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Rural.png")

```

##MSFT, High-Income vs Low-Income, LAU Unemployment

```{r}

full_df_highincome <- full_df[full_df$income_below_0_above_1== "1",]

var_label(full_df_highincome) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowincome <- full_df[full_df$income_below_0_above_1== "0", ]

var_label(full_df_lowincome) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High Income

ols_2019msft_25_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019msft_40_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019msft_50_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019msft_75_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

tb1 <-
  ols_2019msft_25_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_HighIncome <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High Income**", "**Treat = 40% Penetration, 2019 MSFT High Income**", "**Treat = 50% Penetration, 2019 MSFT High Income**", "**Treat = 75% Penetration, 2019 MSFT High Income**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Income", subtitle = "High-Income")

gt::gtsave(tbl_merge_2019_MSFT_HighIncome, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Income.png")


ols_2020msft_25_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020msft_40_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020msft_50_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020msft_75_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

tb1 <-
  ols_2020msft_25_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_HighIncome <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High Income**", "**Treat = 40% Penetration, 2020 MSFT High Income**", "**Treat = 50% Penetration, 2020 MSFT High Income**", "**Treat = 75% Penetration, 2020 MSFT High Income**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Income", subtitle = "High-Income")

gt::gtsave(tbl_merge_2020_MSFT_HighIncome, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Income.png")

#LOW INCOME

ols_2019msft_25_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019msft_40_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019msft_50_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019msft_75_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

tb1 <-
  ols_2019msft_25_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_LowIncome <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low Income**", "**Treat = 40% Penetration, 2019 MSFT Low Income**", "**Treat = 50% Penetration, 2019 MSFT Low Income**", "**Treat = 75% Penetration, 2019 MSFT Low Income**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*"))  %>%
    gt::tab_header(title = "2019 MSFT - Subset on Income", subtitle = "Low-Income")

gt::gtsave(tbl_merge_2019_MSFT_LowIncome, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Income.png")

ols_2020msft_25_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020msft_40_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020msft_50_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020msft_75_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

tb1 <-
  ols_2020msft_25_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_LowIncome <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low Income**", "**Treat = 40% Penetration, 2020 MSFT Low Income**", "**Treat = 50% Penetration, 2020 MSFT Low Income**", "**Treat = 75% Penetration, 2020 MSFT Low Income**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*"))  %>%
    gt::tab_header(title = "2020 MSFT - Subset on Income", subtitle = "Low-Income")

gt::gtsave(tbl_merge_2020_MSFT_LowIncome, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Income.png")
```

##MSFT, High EID vs Low EID, LAU Unemployment

```{r}
full_df_highEID <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "1",]

var_label(full_df_highEID) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowEID <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "0", ]

var_label(full_df_lowEID) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High EID 2020

ols_2020msft_25_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2020msft_40_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2020msft_50_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters= state, data = full_df_highEID)

ols_2020msft_75_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

tb1 <-
  ols_2020msft_25_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_HighEID <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High EID**", "**Treat = 40% Penetration, 2020 MSFT High EID**", "**Treat = 50% Penetration, 2020 MSFT High EID**", "**Treat = 75% Penetration, 2020 MSFT High EID**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Essential Designated Industries", subtitle = "High EID")

gt::gtsave(tbl_merge_2020_MSFT_HighEID, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High EID.png")

#Low EID 2020

ols_2020msft_25_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2020msft_40_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2020msft_50_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2020msft_75_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

tb1 <-
  ols_2020msft_25_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_LowEID <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low EID**", "**Treat = 40% Penetration, 2020 MSFT Low EID**", "**Treat = 50% Penetration, 2020 MSFT Low EID**", "**Treat = 75% Penetration, 2020 MSFT Low EID**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Essential Designated Industries", subtitle = "Low EID")

gt::gtsave(tbl_merge_2020_MSFT_LowEID, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low EID.png")

#High EID 2019

ols_2019msft_25_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019msft_40_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019msft_50_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019msft_75_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

tb1 <-
  ols_2019msft_25_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_HighEID <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High EID**", "**Treat = 40% Penetration, 2019 MSFT High EID**", "**Treat = 50% Penetration, 2019 MSFT High EID**", "**Treat = 75% Penetration, 2019 MSFT High EID**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*"))  %>%
    gt::tab_header(title = "2019 MSFT - Subset on Essential Designated Industries", subtitle = "High EID")

gt::gtsave(tbl_merge_2019_MSFT_HighEID, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High EID.png")

#Low EID 2019

ols_2019msft_25_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019msft_40_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019msft_50_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019msft_75_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

tb1 <-
  ols_2019msft_25_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowEID %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_LowEID <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low EID**", "**Treat = 40% Penetration, 2019 MSFT Low EID**", "**Treat = 50% Penetration, 2019 MSFT Low EID**", "**Treat = 75% Penetration, 2019 MSFT Low EID**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Essential Designated Industries", subtitle = "Low EID")

gt::gtsave(tbl_merge_2019_MSFT_LowEID, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low EID.png")

```

##MSFT, High Black vs Low Black, LAU Unemployment

```{r}

full_df_highblack <- full_df[full_df$Black_Below_0_Above_1== "1",]

var_label(full_df_highblack) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowblack <- full_df[full_df$Black_Below_0_Above_1== "0", ]

var_label(full_df_lowblack) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High Black 2020

ols_2020msft_25_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2020msft_40_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2020msft_50_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2020msft_75_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

tb1 <-
  ols_2020msft_25_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Black <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High % Black**", "**Treat = 40% Penetration, 2020 MSFT % Black**", "**Treat = 50% Penetration, 2020 MSFT High % Black**", "**Treat = 75% Penetration, 2020 MSFT High % Black**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Percentage Black Pop", subtitle = "Above Median Percent Black Pop")

gt::gtsave(tbl_merge_2020_MSFT_Black, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Percent Black.png")

#Low Black 2020 

ols_2020msft_25_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2020msft_40_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2020msft_50_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2020msft_75_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

tb1 <-
  ols_2020msft_25_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Black <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low % Black**", "**Treat = 40% Penetration, 2020 MSFT Low % Black**", "**Treat = 50% Penetration, 2020 MSFT Low % Black**", "**Treat = 75% Penetration, 2020 MSFT Low % Black**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Percentage Black Pop", subtitle = "Below Median Percent Black Pop")

gt::gtsave(tbl_merge_2020_MSFT_Black, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Percent Black.png")

#High Black 2019

ols_2019msft_25_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019msft_40_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019msft_50_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019msft_75_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

tb1 <-
  ols_2019msft_25_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Black <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High % Black**", "**Treat = 40% Penetration, 2019 MSFT % Black**", "**Treat = 50% Penetration, 2019 MSFT High % Black**", "**Treat = 75% Penetration, 2019 MSFT High % Black**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Percentage Black Pop", subtitle = "Above Median Percent Black Pop")

gt::gtsave(tbl_merge_2019_MSFT_Black, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Percent Black.png")

#Low Black 2019

ols_2019msft_25_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019msft_40_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019msft_50_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019msft_75_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

tb1 <-
  ols_2019msft_25_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowblack %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Black <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low % Black**", "**Treat = 40% Penetration, 2019 MSFT Low % Black**", "**Treat = 50% Penetration, 2019 MSFT Low % Black**", "**Treat = 75% Penetration, 2019 MSFT Low % Black**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Percentage Black Pop", subtitle = "Below Median Percent Black Pop")

gt::gtsave(tbl_merge_2019_MSFT_Black, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Percent Black.png")

```

##MSFT, High Hispanic vs Low Hispanic, LAU Unemployment

```{r}

full_df_highhispanic <- full_df[full_df$Hispanic_Below_0_Above_1== "1",]

var_label(full_df_highhispanic) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowhispanic <- full_df[full_df$Hispanic_Below_0_Above_1== "0", ]

var_label(full_df_lowhispanic) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High Hispanic 2020 

ols_2020msft_25_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2020msft_40_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2020msft_50_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2020msft_75_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

tb1 <-
  ols_2020msft_25_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Hispanic <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High % Hispanic**", "**Treat = 40% Penetration, 2020 MSFT High % Hispanic**", "**Treat = 50% Penetration, 2020 MSFT High % Black**", "**Treat = 75% Penetration, 2020 MSFT High % Hispanic*")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Percentage Hispanic Pop", subtitle = "Above Median Percent Hispanic Pop")

gt::gtsave(tbl_merge_2020_MSFT_Hispanic, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Percent Hispanic.png")

#Low Hispanic 2020 

ols_2020msft_25_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2020msft_40_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2020msft_50_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2020msft_75_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

tb1 <-
  ols_2020msft_25_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Hispanic <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low % Hispanic**", "**Treat = 40% Penetration, 2020 MSFT Low % Hispanic**", "**Treat = 50% Penetration, 2020 MSFT Low % Hispanic**", "**Treat = 75% Penetration, 2020 MSFT Low % Hispanic**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Percentage Hispanic Pop", subtitle = "Below Median Percent Hispanic Pop")

gt::gtsave(tbl_merge_2020_MSFT_Hispanic, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Percent Hispanic.png")

#High Hispanic 2019

ols_2019msft_25_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019msft_40_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019msft_50_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019msft_75_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

tb1 <-
  ols_2019msft_25_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Hispanic <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High % Hispanic**", "**Treat = 40% Penetration, 2019 MSFT High % Hispanic**", "**Treat = 50% Penetration, 2019 MSFT High % Black**", "**Treat = 75% Penetration, 2019 MSFT High % Hispanic*")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Percentage Hispanic Pop", subtitle = "Above Median Percent Hispanic Pop")

gt::gtsave(tbl_merge_2019_MSFT_Hispanic, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Percent Hispanic.png")

#Low Hispanic 2019

ols_2019msft_25_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019msft_40_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019msft_50_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019msft_75_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

tb1 <-
  ols_2019msft_25_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowhispanic %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Hispanic <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low % Hispanic**", "**Treat = 40% Penetration, 2019 MSFT Low % Hispanic**", "**Treat = 50% Penetration, 2019 MSFT Low % Black**", "**Treat = 75% Penetration, 2019 MSFT Low % Hispanic*")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2019 MSFT - Subset on Percentage Hispanic Pop", subtitle = "Below Median Percent Hispanic Pop")

gt::gtsave(tbl_merge_2019_MSFT_Hispanic, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Percent Hispanic.png")

```

##MSFT, High Tech vs Low Tech, LAU Unemployment

```{r}
full_df_hightech <- full_df[full_df$HighTech_Below_0_Above_1== "1",]

var_label(full_df_hightech) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowtech <- full_df[full_df$HighTech_Below_0_Above_1== "0", ]

var_label(full_df_lowtech) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High Tech 2020 

ols_2020msft_25_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2020msft_40_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2020msft_50_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2020msft_75_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

tb1 <-
  ols_2020msft_25_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Tech <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High Tech**", "**Treat = 40% Penetration, 2020 MSFT High Tech**", "**Treat = 50% Penetration, 2020 MSFT High Tech**", "**Treat = 75% Penetration, 2020 MSFT High Tech**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Percentage Employed in Tech", subtitle = "Above Median Tech")

gt::gtsave(tbl_merge_2020_MSFT_Tech, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Tech.png")

#Low Tech 2020

ols_2020msft_25_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2020msft_40_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2020msft_50_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2020msft_75_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

tb1 <-
  ols_2020msft_25_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Tech <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low Tech**", "**Treat = 40% Penetration, 2020 MSFT Low Tech**", "**Treat = 50% Penetration, 2020 MSFT Low Tech**", "**Treat = 75% Penetration, 2020 MSFT Low Tech**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Percentage Employed in Tech", subtitle = "Below Median Tech")

gt::gtsave(tbl_merge_2020_MSFT_Tech, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Tech.png")

#High Tech 2019

ols_2019msft_25_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019msft_40_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019msft_50_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019msft_75_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

tb1 <-
  ols_2019msft_25_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_hightech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Tech <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High Tech**", "**Treat = 40% Penetration, 2019 MSFT High Tech**", "**Treat = 50% Penetration, 2019 MSFT High Tech**", "**Treat = 75% Penetration, 2019 MSFT High Tech**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Percentage Employed in Tech", subtitle = "Above Median Tech")

gt::gtsave(tbl_merge_2019_MSFT_Tech, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Tech.png")

#Low Tech 2019

ols_2019msft_25_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019msft_40_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019msft_50_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019msft_75_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

tb1 <-
  ols_2019msft_25_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowtech %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Tech <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low Tech**", "**Treat = 40% Penetration, 2019 MSFT Low Tech**", "**Treat = 50% Penetration, 2019 MSFT Low Tech**", "**Treat = 75% Penetration, 2019 MSFT Low Tech**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Percentage Employed in Tech", subtitle = "Below Median Tech")

gt::gtsave(tbl_merge_2019_MSFT_Tech, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Tech.png")

```

##MSFT, High Service Sector vs Low Service Sector, LAU Unemployment

```{r}

full_df_highservice <- full_df[full_df$Services_Below_0_Above_1 == "1",]

var_label(full_df_highservice) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")


full_df_lowservice <- full_df[full_df$Services_Below_0_Above_1== "0", ]

var_label(full_df_lowservice) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#High Services MSFT 2020

ols_2020msft_25_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020msft_40_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020msft_50_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020msft_75_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

tb1 <-
  ols_2020msft_25_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT High Service**", "**Treat = 40% Penetration, 2020 MSFT High Service**", "**Treat = 50% Penetration, 2020 MSFT High Service**", "**Treat = 75% Penetration, 2020 MSFT High Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Percentage Employed in Service", subtitle = "Above Median Service")

gt::gtsave(tbl_merge_2020_MSFT_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Service.png")

#Low Services 2020

ols_2020msft_25_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2020msft_40_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2020msft_50_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2020msft_75_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

tb1 <-
  ols_2020msft_25_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Low Service**", "**Treat = 40% Penetration, 2020 MSFT Low Service**", "**Treat = 50% Penetration, 2020 MSFT Low Service**", "**Treat = 75% Penetration, 2020 MSFT Low Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Percentage Employed in Service", subtitle = "Below Median Service")

gt::gtsave(tbl_merge_2020_MSFT_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Service.png")

#High Services MSFT 2019

ols_2019msft_25_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019msft_40_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019msft_50_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019msft_75_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

tb1 <-
  ols_2019msft_25_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT High Service**", "**Treat = 40% Penetration, 2019 MSFT High Service**", "**Treat = 50% Penetration, 2019 MSFT High Service**", "**Treat = 75% Penetration, 2019 MSFT High Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Percentage Employed in Service", subtitle = "Above Median Service")

gt::gtsave(tbl_merge_2019_MSFT_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Service.png")

#Low Services 2019

ols_2019msft_25_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2019msft_40_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2019msft_50_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

ols_2019msft_75_unemployment_lowservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowservice)

tb1 <-
  ols_2019msft_25_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Low Service**", "**Treat = 40% Penetration, 2019 MSFT Low Service**", "**Treat = 50% Penetration, 2019 MSFT Low Service**", "**Treat = 75% Penetration, 2019 MSFT Low Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Percentage Employed in Service", subtitle = "Below Median Service")

gt::gtsave(tbl_merge_2019_MSFT_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Service.png")

```


##MSFT, Single-Parent Households vs Dual Parent Households, LAU Unemployment 

```{r}

full_df_highsingleparents<- full_df[full_df$SingleParent_Below_0_Above_1 == "1",]

var_label(full_df_highsingleparents) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowsingleparents <- full_df[full_df$SingleParent_Below_0_Above_1== "0", ]

var_label(full_df_lowsingleparents) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above Median Single Parents 2020 MSFT

ols_2020msft_25_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2020msft_40_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2020msft_50_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2020msft_75_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

tb1 <-
  ols_2020msft_25_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_SingleParents <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Above Median Single Parents**", "**Treat = 40% Penetration, 2020 MSFT Above Median Single Parents**", "**Treat = 50% Penetration, 2020 MSFT Above Median Single Parents**", "**Treat = 75% Penetration, 2020 MSFT Above Median Single Parents**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Households with Single Parents", subtitle = "Above Median Single Parents")

gt::gtsave(tbl_merge_2020_MSFT_SingleParents, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT High Single Parents.png")

#Below Median Single Parents 2020

ols_2020msft_25_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2020msft_40_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2020msft_50_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2020msft_75_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

tb1 <-
  ols_2020msft_25_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_SingleParents <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Below Median Single Parents**", "**Treat = 40% Penetration, 2020 MSFT Below Median Single Parents**", "**Treat = 50% Penetration, 2020 MSFT Below Median Single Parents**", "**Treat = 75% Penetration, 2020 MSFT Below Median Single Parents**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Households with Single Parents", subtitle = "Below Median Single Parents")

gt::gtsave(tbl_merge_2020_MSFT_SingleParents, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Low Single Parents.png")

#Above Median Single Parents 2019 MSFT

ols_2019msft_25_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2019msft_40_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2019msft_50_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

ols_2019msft_75_unemployment_highsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highsingleparents)

tb1 <-
  ols_2019msft_25_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_SingleParents <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Above Median Single Parents**", "**Treat = 40% Penetration, 2019 MSFT Above Median Single Parents**", "**Treat = 50% Penetration, 2019 MSFT Above Median Single Parents**", "**Treat = 75% Penetration, 2019 MSFT Above Median Single Parents**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Households with Single Parents", subtitle = "Above Median Single Parents")

gt::gtsave(tbl_merge_2019_MSFT_SingleParents, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT High Single Parents.png")

#Below Median Single Parents 2019 MSFT

ols_2019msft_25_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2019msft_40_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2019msft_50_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

ols_2019msft_75_unemployment_lowsingleparents <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowsingleparents)

tb1 <-
  ols_2019msft_25_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowsingleparents %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_SingleParents <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Below Median Single Parents**", "**Treat = 40% Penetration, 2019 MSFT Below Median Single Parents**", "**Treat = 50% Penetration, 2019 MSFT Below Median Single Parents**", "**Treat = 75% Penetration, 2019 MSFT Below Median Single Parents**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Households with Single Parents", subtitle = "Below Median Single Parents")

gt::gtsave(tbl_merge_2019_MSFT_SingleParents, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Low Single Parents.png")


```

##MSFT, HH with Kids vs HH without Kids, LAU Unemployment 

```{r}

full_df_highkidsunder18<- full_df[full_df$KidsUnder18_Below_0_Above_1 == "1",]

var_label(full_df_highkidsunder18) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowkidsunder18 <- full_df[full_df$KidsUnder18_Below_0_Above_1== "0", ]

var_label(full_df_lowkidsunder18) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above Median Single Parents MSFT 2020

ols_2020msft_25_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020msft_40_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020msft_50_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020msft_75_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

tb1 <-
  ols_2020msft_25_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Above Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2020 MSFT Above Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2020 MSFT Above Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2020 MSFT Above Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Households with Kids Under 18", subtitle = "Above Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2020_MSFT_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Above Median HH with Kids Under 18.png")

#Below Median Single Parents MSFT 2020

ols_2020msft_25_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2020msft_40_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2020msft_50_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2020msft_75_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

tb1 <-
  ols_2020msft_25_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Below Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2020 MSFT Below Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2020 MSFT Below Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2020 MSFT Below Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Subset on Households with Kids Under 18", subtitle = "Below Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2020_MSFT_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Below Median HH with Kids Under 18.png")

#Above Median Single Parents MSFT 2019

ols_2019msft_25_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019msft_40_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019msft_50_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019msft_75_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

tb1 <-
  ols_2019msft_25_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Above Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2019 MSFT Above Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2019 MSFT Above Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2019 MSFT Above Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Households with Kids Under 18", subtitle = "Above Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2019_MSFT_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Above Median HH with Kids Under 18.png")

#Below Median Single Parents MSFT 2019

ols_2019msft_25_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2019msft_40_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2019msft_50_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

ols_2019msft_75_unemployment_lowkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowkidsunder18)

tb1 <-
  ols_2019msft_25_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019msft_40_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019msft_50_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019msft_75_unemployment_lowkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT Below Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2019 MSFT Below Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2019 MSFT Below Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2019 MSFT Below Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 MSFT - Subset on Households with Kids Under 18", subtitle = "Below Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2019_MSFT_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Below Median HH with Kids Under 18.png")

```

##MSFT, Building Density

```{r}

full_df_highnewbuildings <- full_df[full_df$NewHouseUnits_Above1_Below0 == "1",]

var_label(full_df_highnewbuildings) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lownewbuildings <- full_df[full_df$NewHouseUnits_Above1_Below0 == "0",]

var_label(full_df_lownewbuildings) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above Median New Buildings 2020

ols_2020msft_25_unemployment_highnewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings)

ols_2020msft_40_unemployment_highnewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings)

ols_2020msft_50_unemployment_highnewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings)

ols_2020msft_75_unemployment_highnewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings)

tb1 <-
  ols_2020msft_25_unemployment_highnewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highnewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highnewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highnewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Buildings_High <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Above Median New Buildings**", "**Treat = 40% Penetration, 2020 MSFT Above Median New Buildings**", "**Treat = 50% Penetration, 2020 MSFT Above Median New Buildings**", "**Treat = 75% Penetration, 2020 MSFT Above Median New Buildings**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on New Building Construction", subtitle = "Above Median New Buildings")

gt::gtsave(tbl_merge_2020_MSFT_Buildings_High, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Above Median New Buildings.png")

#Below Median New Buildlings 2020

ols_2020msft_25_unemployment_lownewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings)

ols_2020msft_40_unemployment_lownewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings)

ols_2020msft_50_unemployment_lownewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings)

ols_2020msft_75_unemployment_lownewbuildings <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings)

tb1 <-
  ols_2020msft_25_unemployment_lownewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lownewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lownewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lownewbuildings %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Buildings_Below <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Below Median New Buildings**", "**Treat = 40% Penetration, 2020 MSFT Below Median New Buildings**", "**Treat = 50% Penetration, 2020 MSFT Below Median New Buildings**", "**Treat = 75% Penetration, 2020 MSFT Below Median New Buildings**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on New Building Construction", subtitle = "Below Median New Buildings")

gt::gtsave(tbl_merge_2020_MSFT_Buildings_Below, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Below Median New Buildings.png")
```

##MSFT, Bridge Density

```{r}

full_df_highbridges <- full_df[full_df$BridgeCount_Above1_Below0 == "1",]

var_label(full_df_highbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lowbridges <- full_df[full_df$BridgeCount_Above1_Below0 == "0", ]

var_label(full_df_lowbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above Median Bridges 2020

ols_2020msft_25_unemployment_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highbridges)

ols_2020msft_40_unemployment_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highbridges)

ols_2020msft_50_unemployment_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highbridges)

ols_2020msft_75_unemployment_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highbridges)

tb1 <-
  ols_2020msft_25_unemployment_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Bridges_High <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Above Median Bridges**", "**Treat = 40% Penetration, 2020 MSFT Above Median Bridges**", "**Treat = 50% Penetration, 2020 MSFT Above Median Bridges**", "**Treat = 75% Penetration, 2020 MSFT Above Median Bridges**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Bridge Density per County", subtitle = "Above Median Bridges")

gt::gtsave(tbl_merge_2020_MSFT_Bridges_High, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Above Median Bridges.png")

#Below Median New Bridges 2020

ols_2020msft_25_unemployment_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowbridges)

ols_2020msft_40_unemployment_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowbridges)

ols_2020msft_50_unemployment_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowbridges)

ols_2020msft_75_unemployment_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowbridges)

tb1 <-
  ols_2020msft_25_unemployment_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_unemployment_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_unemployment_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_MSFT_Bridges_Low <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT Below Median Bridges**", "**Treat = 40% Penetration, 2020 MSFT Below Median Bridges**", "**Treat = 50% Penetration, 2020 MSFT Below Median Bridges**", "**Treat = 75% Penetration, 2020 MSFT Below Median Bridges**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT - Subset on Bridge Density per County", subtitle = "Below Median Bridges")

gt::gtsave(tbl_merge_2020_MSFT_Bridges_Low, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Below Median Bridges.png")
```

##MSFT, Building and Bridge Interaction

```{r}

full_df_highnewbuildings_highbridges <- full_df[full_df$NewHouseUnits_Above1_Below0 == "1" & full_df$BridgeCount_Above1_Below0 == "1",]

var_label(full_df_highnewbuildings_highbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_highnewbuildings_lowbridges <- full_df[full_df$NewHouseUnits_Above1_Below0 == "1" & full_df$BridgeCount_Above1_Below0 == "0",]

var_label(full_df_highnewbuildings_lowbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lownewbuildings_highbridges <- full_df[full_df$NewHouseUnits_Above1_Below0 == "0" & full_df$BridgeCount_Above1_Below0 == "1",]

var_label(full_df_lownewbuildings_highbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

full_df_lownewbuildings_lowbridges <- full_df[full_df$NewHouseUnits_Above1_Below0 == "0" & full_df$BridgeCount_Above1_Below0 == "0",]

var_label(full_df_lownewbuildings_lowbridges) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")


#Above Median New Buildings

ols_2020msft_50_unemployment_highnewbuildings_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings_highbridges)

ols_2020msft_50_unemployment_highnewbuildings_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highnewbuildings_lowbridges)

ols_2020msft_50_unemployment_lownewbuildings_highbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings_highbridges)

ols_2020msft_50_unemployment_lownewbuildings_lowbridges <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lownewbuildings_lowbridges)

tb1 <-
  ols_2020msft_50_unemployment_highnewbuildings_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_50_unemployment_highnewbuildings_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_unemployment_lownewbuildings_highbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_50_unemployment_lownewbuildings_lowbridges %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2029_MSFT_BridgeBuildings <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**High New Buildings, High Bridges**", "**High New Buildings, Low Bridges**", "**Low New Buildings, High Bridges**", "**Low New Buildings, Low Bridges**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT - Split on Buildings and Bridges", subtitle = "Only for Base Case (50% Penetration)")

gt::gtsave(tbl_merge_2029_MSFT_BridgeBuildings, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 Bridge and Building Interaction.png")


```

#2019 FCC, LAU Unemployment

```{r}

ols_2019fcc_25_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2019fcc_40_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters= state, data = full_df)

ols_2019fcc_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2019fcc_75_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2019fcc_25_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC**", "**Treat = 40% Penetration, 2019 FCC**", "**Treat = 50% Penetration, 2019 FCC**", "**Treat = 75% Penetration, 2019 FCC**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC", subtitle = "Full Sample")

gt::gtsave(tbl_merge_2019_FCC, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC.png")

```

##FCC, Urban vs Rural, LAU Unemployment

```{r}

#Urban

ols_2019fcc_25_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019fcc_40_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019fcc_50_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2019fcc_75_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

tb1 <-
  ols_2019fcc_25_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC_Urban <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Urban**", "**Treat = 40% Penetration, 2019 FCC Urban**", "**Treat = 50% Penetration, 2019 FCC Urban**", "**Treat = 75% Penetration, 2019 FCC Urban**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC - Subset on Urban and Rural", subtitle = "Urban") 

gt::gtsave(tbl_merge_2019_FCC_Urban, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC Urban.png")

#Rural

ols_2019fcc_25_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019fcc_40_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019fcc_50_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2019fcc_75_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)


tb1 <-
  ols_2019fcc_25_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC_Rural <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Rural**", "**Treat = 40% Penetration, 2019 FCC Rural**", "**Treat = 50% Penetration, 2019 FCC Rural**", "**Treat = 75% Penetration, 2019 FCC Rural**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC - Subset on Urban and Rural", subtitle = "Rural")

gt::gtsave(tbl_merge_2019_FCC_Rural, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC Rural.png")

```

##FCC, High-Income vs Low-Income, LAU Unemployment

```{r}

#High Income

ols_2019fcc_25_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019fcc_40_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019fcc_50_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019fcc_75_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)


tb1 <-
  ols_2019fcc_25_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment_highincome %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC_HighIncome <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High Income**", "**Treat = 40% Penetration, 2019 FCC High Income**", "**Treat = 50% Penetration, 2019 FCC High Income**", "**Treat = 75% Penetration, 2019 FCC High Income**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC - Subset on Income", subtitle = "High-Income")

gt::gtsave(tbl_merge_2019_FCC_Rural, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC Rural.png")


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High Income**", "**Treat = 40% Penetration, 2019 FCC High Income**", "**Treat = 50% Penetration, 2019 FCC High Income**", "**Treat = 75% Penetration, 2019 FCC High Income**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC High Income.png")

```

FCC 2020 - NOT RUN
```{r}
ols_2020fcc_25_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2020 + COVID_0_Pre_1_Post*fcc_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020fcc_40_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2020 + COVID_0_Pre_1_Post*fcc_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020fcc_50_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2020 + COVID_0_Pre_1_Post*fcc_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2020fcc_75_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2020 + COVID_0_Pre_1_Post*fcc_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

tb1<- tbl_regression(ols_2020fcc_25_unemployment_highincome, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2020 ~ "Treat (25%, FCC 2020)"))

tb2<- tbl_regression(ols_2020fcc_40_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2020 ~ "Treat (40%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020fcc_50_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2020 ~ "Treat (50%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020fcc_75_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2020 ~ "Treat (75%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 FCC High Income**", "**Treat = 40% Penetration, 2020 FCC High Income**", "**Treat = 50% Penetration, 2020 FCC High Income**", "**Treat = 75% Penetration, 2020 FCC High Income**"))

gt::gtsave(as_gt(tbl_merge_2020_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2020 FCC High Income.png")
```


LOW INCOME
```{r}
ols_2019fcc_25_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019fcc_40_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019fcc_50_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019fcc_75_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_lowincome, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Low Income**", "**Treat = 40% Penetration, 2019 FCC Low Income**", "**Treat = 50% Penetration, 2019 FCC Low Income**", "**Treat = 75% Penetration, 2019 FCC Low Income**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC Low Income.png")

```

FCC 2020 - NOT RUN
```{r}
ols_2020fcc_25_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2020 + COVID_0_Pre_1_Post*fcc_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020fcc_40_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2020 + COVID_0_Pre_1_Post*fcc_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020fcc_50_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2020 + COVID_0_Pre_1_Post*fcc_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2020fcc_75_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2020 + COVID_0_Pre_1_Post*fcc_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

tb1<- tbl_regression(ols_2020fcc_25_unemployment_lowincome, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2020 ~ "Treat (25%, FCC 2020)"))

tb2<- tbl_regression(ols_2020fcc_40_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2020 ~ "Treat (40%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020fcc_50_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2020 ~ "Treat (50%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020fcc_75_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2020 ~ "Treat (75%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 FCC Low Income**", "**Treat = 40% Penetration, 2020 FCC Low Income**", "**Treat = 50% Penetration, 2020 FCC Low Income**", "**Treat = 75% Penetration, 2020 FCC Low Income**"))

gt::gtsave(as_gt(tbl_merge_2020_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2020 FCC Low Income.png")
```

##FCC, High EID vs Low EID, LAU Unemployment

```{r}

#High EID

ols_2019fcc_25_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019fcc_40_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019fcc_50_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019fcc_75_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_highEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High EID**", "**Treat = 40% Penetration, 2019 FCC EID Income**", "**Treat = 50% Penetration, 2019 FCC High EID**", "**Treat = 75% Penetration, 2019 FCC High EID**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC High EID.png")
```

FCC 2020 - NOT RUN
```{r}
ols_2020fcc_25_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2020 + COVID_0_Pre_1_Post*fcc_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2020fcc_40_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2020 + COVID_0_Pre_1_Post*fcc_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2020fcc_50_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2020 + COVID_0_Pre_1_Post*fcc_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2020fcc_75_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2020 + COVID_0_Pre_1_Post*fcc_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

tb1<- tbl_regression(ols_2020fcc_25_unemployment_highEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2020 ~ "Treat (25%, FCC 2020)"))

tb2<- tbl_regression(ols_2020fcc_40_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2020 ~ "Treat (40%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020fcc_50_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2020 ~ "Treat (50%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020fcc_75_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2020 ~ "Treat (75%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 FCC High EID**", "**Treat = 40% Penetration, 2020 FCC High EID**", "**Treat = 50% Penetration, 2020 FCC High EID**", "**Treat = 75% Penetration, 2020 FCC High EID**"))

gt::gtsave(as_gt(tbl_merge_2020_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2020 FCC High EID.png")

```

LOW EID
```{r}
ols_2019fcc_25_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019fcc_40_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019fcc_50_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019fcc_75_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_lowEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Low EID**", "**Treat = 40% Penetration, 2019 FCC Low EID**", "**Treat = 50% Penetration, 2019 FCC Low EID**", "**Treat = 75% Penetration, 2019 FCC Low EID**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC Low EID.png")

```

FCC 2020 - NOT RUN
```{r}
ols_2020fcc_25_unemployment_lowEID <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2020 + COVID_0_Pre_1_Post*fcc_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_lowEID)

ols_2020fcc_40_unemployment_lowEID <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2020 + COVID_0_Pre_1_Post*fcc_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_lowEID)

ols_2020fcc_50_unemployment_lowEID <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2020 + COVID_0_Pre_1_Post*fcc_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_lowEID)

ols_2020fcc_75_unemployment_lowEID <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2020 + COVID_0_Pre_1_Post*fcc_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_lowEID)

tb1<- tbl_regression(ols_2020fcc_25_unemployment_lowEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2020 ~ "Treat (25%, FCC 2020)"))

tb2<- tbl_regression(ols_2020fcc_40_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2020 ~ "Treat (40%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020fcc_50_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2020 ~ "Treat (50%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020fcc_75_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2020 ~ "Treat (75%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 FCC Low EID**", "**Treat = 40% Penetration, 2020 FCC Low EID**", "**Treat = 50% Penetration, 2020 FCC Low EID**", "**Treat = 75% Penetration, 2020 FCC Low EID**"))

gt::gtsave(as_gt(tbl_merge_2020_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2020 FCC Low EID.png")
```

##FCC, High Black vs Low Black, LAU Unemployment

```{r}

#High Black

ols_2019fcc_25_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019fcc_40_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019fcc_50_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019fcc_75_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_highblack, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High % Black**", "**Treat = 40% Penetration, 2019 FCC Hiigh % Black**", "**Treat = 50% Penetration, 2019 FCC High % Black**", "**Treat = 75% Penetration, 2019 FCC High % Black**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC High Percent Black.png")


#LOW Black

ols_2019fcc_25_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019fcc_40_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019fcc_50_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019fcc_75_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_lowblack, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Low % Black**", "**Treat = 40% Penetration, 2019 FCC Low % Black**", "**Treat = 50% Penetration, 2019 FCC Low % Black**", "**Treat = 75% Penetration, 2019 FCC Low % Black**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC Low Percent Black.png")

```

##FCC, High Hispanic vs Low Hispanic, LAU Unemployment

```{r}

#High Hispanic

ols_2019fcc_25_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019fcc_40_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019fcc_50_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019fcc_75_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_highhispanic, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High % Hispanic**", "**Treat = 40% Penetration, 2019 FCC Hiigh % Hispanic**", "**Treat = 50% Penetration, 2019 FCC High % Hispanic**", "**Treat = 75% Penetration, 2019 FCC High % Hispanic**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC High Percent Hispanic.png")


#Low Hispanic

ols_2019fcc_25_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019fcc_40_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019fcc_50_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019fcc_75_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_lowhispanic, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Low % Hispanic**", "**Treat = 40% Penetration, 2019 FCC Low % Hispanic**", "**Treat = 50% Penetration, 2019 FCC Low % Hispanic**", "**Treat = 75% Penetration, 2019 FCC Low % Hispanic**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC Low Percent Hispanic.png")

```

##FCC, High Tech vs Low Tech, LAU Unemployment

```{r}

#High Tech

ols_2019fcc_25_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019fcc_40_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019fcc_50_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019fcc_75_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_hightech, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High Tech**", "**Treat = 40% Penetration, 2019 FCC Tech Income**", "**Treat = 50% Penetration, 2019 FCC High Tech**", "**Treat = 75% Penetration, 2019 FCC High Tech**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC High Tech.png")

#LOW Tech

ols_2019fcc_25_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019fcc_40_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019fcc_50_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019fcc_75_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)


tb1<- tbl_regression(ols_2019fcc_25_unemployment_lowtech, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", fcc_25_or_more_2019 ~ "Treat (25%, FCC 2019)"))

tb2<- tbl_regression(ols_2019fcc_40_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_40_or_more_2019 ~ "Treat (40%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019fcc_50_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019fcc_75_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_75_or_more_2019 ~ "Treat (75%, FCC 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_FCC <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Low Tech**", "**Treat = 40% Penetration, 2019 FCC Low Tech**", "**Treat = 50% Penetration, 2019 FCC Low Tech**", "**Treat = 75% Penetration, 2019 FCC Low Tech**"))

gt::gtsave(as_gt(tbl_merge_2019_FCC), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 FCC Low Tech.png")

```

##FCC, High Service Sector vs Low Service Sector, LAU Unemployment
```{r}

##High Services FCC 2019
ols_2019fcc_25_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019fcc_40_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019fcc_50_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2019fcc_75_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

tb1 <-
  ols_2019fcc_25_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC High Service**", "**Treat = 40% Penetration, 2019 FCC High Service**", "**Treat = 50% Penetration, 2019 FCC High Service**", "**Treat = 75% Penetration, 2019 FCC High Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC - Subset on Percentage Employed in Service", subtitle = "Above Median Service")

gt::gtsave(tbl_merge_2019_FCC_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC High Service.png")

```

##FCC, HH with Kids vs HH without Kids, LAU Unemployment 

```{r}

#Above Median HH with Kids

ols_2019fcc_25_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_25_or_more_2019 + COVID_0_Pre_1_Post*fcc_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019fcc_40_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_40_or_more_2019 + COVID_0_Pre_1_Post*fcc_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019fcc_50_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2019fcc_75_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_75_or_more_2019 + COVID_0_Pre_1_Post*fcc_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

tb1 <-
  ols_2019fcc_25_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2019fcc_40_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2019fcc_50_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2019fcc_75_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_FCC_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2019 FCC Above Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2019 FCC Above Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2019 FCC Above Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2019 FCC Above Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 FCC - Subset on Households with Kids Under 18", subtitle = "Above Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2019_FCC_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 FCC Above Median HH with Kids Under 18.png")

```

#2019 ACS, LAU Unemployment

```{r}

ols_2020acs_25_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020acs_40_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020acs_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020acs_75_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2020acs_25_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020acs_40_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020acs_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020acs_75_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_ACS <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 ACS**", "**Treat = 40% Penetration, 2020 ACS**", "**Treat = 50% Penetration, 2020 ACS**", "**Treat = 75% Penetration, 2020 ACS**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 ACS", subtitle = "Full Sample")

gt::gtsave(tbl_merge_2020_ACS, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 ACS.png")

```

##ACS, Urban vs Rural, LAU Unemployment

```{r}

#Urban

ols_2020acs_25_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020acs_40_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020acs_50_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)

ols_2020acs_75_unemployment_urban <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_urban)


tb1 <-
  ols_2020acs_25_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020acs_40_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020acs_50_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020acs_75_unemployment_urban %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_ACS_Urban <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 ACS Urban**", "**Treat = 40% Penetration, 2020 ACS Urban**", "**Treat = 50% Penetration, 2020 ACS Urban**", "**Treat = 75% Penetration, 2020 ACS Urban**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 ACS - Subset on Urban and Rural", subtitle = "Urban")

gt::gtsave(tbl_merge_2020_ACS_Urban, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 ACS Urban.png")

#Rural

ols_2020acs_25_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020acs_40_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020acs_50_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)

ols_2020acs_75_unemployment_rural <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_rural)


tb1 <-
  ols_2020acs_25_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020acs_40_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020acs_50_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020acs_75_unemployment_rural %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_ACS_Rural <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 ACS Rural**", "**Treat = 40% Penetration, 2020 ACS Rural**", "**Treat = 50% Penetration, 2020 ACS Rural**", "**Treat = 75% Penetration, 2020 ACS Rural**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 ACS - Subset on Urban and Rural", subtitle = "Rural")

gt::gtsave(tbl_merge_2020_ACS_Rural, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 ACS Rural.png")

```

##ACS, High-Income vs Low-Income, LAU Unemployment

```{r}

#High Income

ols_2019acs_25_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019acs_40_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019acs_50_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)

ols_2019acs_75_unemployment_highincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highincome)


tb1<- tbl_regression(ols_2019acs_25_unemployment_highincome, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_highincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS High Income**", "**Treat = 40% Penetration, 2019 ACS High Income**", "**Treat = 50% Penetration, 2019 ACS High Income**", "**Treat = 75% Penetration, 2019 ACS High Income**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS High Income.png")


#LOW INCOME

ols_2019acs_25_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019acs_40_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019acs_50_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)

ols_2019acs_75_unemployment_lowincome <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowincome)


tb1<- tbl_regression(ols_2019acs_25_unemployment_lowincome, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_lowincome, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS Low Income**", "**Treat = 40% Penetration, 2019 ACS Low Income**", "**Treat = 50% Penetration, 2019 ACS Low Income**", "**Treat = 75% Penetration, 2019 ACS Low Income**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS Low Income.png")


```

##ACS, High EID vs Low EID, LAU Unemployment

```{r}

#High EID

ols_2019acs_25_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019acs_40_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019acs_50_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)

ols_2019acs_75_unemployment_highEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highEID)


tb1<- tbl_regression(ols_2019acs_25_unemployment_highEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_highEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS High EID**", "**Treat = 40% Penetration, 2019 ACS EID Income**", "**Treat = 50% Penetration, 2019 ACS High EID**", "**Treat = 75% Penetration, 2019 ACS High EID**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS High EID.png")


#LOW EID

ols_2019acs_25_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019acs_40_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019acs_50_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)

ols_2019acs_75_unemployment_lowEID <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowEID)


tb1<- tbl_regression(ols_2019acs_25_unemployment_lowEID, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_lowEID, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS Low EID**", "**Treat = 40% Penetration, 2019 ACS Low EID**", "**Treat = 50% Penetration, 2019 ACS Low EID**", "**Treat = 75% Penetration, 2019 ACS Low EID**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS Low EID.png")

```

##ACS, High Percent Black vs Low Percent Black, LAU Unemployment

```{r}

#High Percent Black

ols_2019acs_25_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019acs_40_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019acs_50_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)

ols_2019acs_75_unemployment_highblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highblack)


tb1<- tbl_regression(ols_2019acs_25_unemployment_highblack, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_highblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS High % Black**", "**Treat = 40% Penetration, 2019 ACS % Black Income**", "**Treat = 50% Penetration, 2019 ACS High % Black**", "**Treat = 75% Penetration, 2019 ACS High % Black**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS High Percent Black.png")


#LOW Percent Black

ols_2019acs_25_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019acs_40_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019acs_50_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)

ols_2019acs_75_unemployment_lowblack <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowblack)


tb1<- tbl_regression(ols_2019acs_25_unemployment_lowblack, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_lowblack, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS Low % Black**", "**Treat = 40% Penetration, 2019 ACS Low % Black**", "**Treat = 50% Penetration, 2019 ACS Low % Black**", "**Treat = 75% Penetration, 2019 ACS Low % Black**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS Low Percent Black.png")

```

##ACS, High Percent Hispanic vs Low Percent Hispanic, LAU Unemployment

```{r}

#High Percent Hispanic

ols_2019acs_25_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019acs_40_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019acs_50_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)

ols_2019acs_75_unemployment_highhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highhispanic)


tb1<- tbl_regression(ols_2019acs_25_unemployment_highhispanic, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_highhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS High % Hispanic**", "**Treat = 40% Penetration, 2019 ACS % Hispanic Income**", "**Treat = 50% Penetration, 2019 ACS High % Hispanic**", "**Treat = 75% Penetration, 2019 ACS High % Hispanic**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS High Percent Hispanic.png")


#Low Percent Hispanic

ols_2019acs_25_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019acs_40_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019acs_50_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)

ols_2019acs_75_unemployment_lowhispanic <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowhispanic)


tb1<- tbl_regression(ols_2019acs_25_unemployment_lowhispanic, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_lowhispanic, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS Low % Hispanic**", "**Treat = 40% Penetration, 2019 ACS Low % Hispanic**", "**Treat = 50% Penetration, 2019 ACS Low % Hispanic**", "**Treat = 75% Penetration, 2019 ACS Low % Hispanic**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS Low Percent Hispanic.png")

```

##ACS, High Tech vs Low Tech, LAU Unemployment

```{r}

#High Tech

ols_2019acs_25_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019acs_40_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019acs_50_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)

ols_2019acs_75_unemployment_hightech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_hightech)


tb1<- tbl_regression(ols_2019acs_25_unemployment_hightech, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_hightech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS High Tech**", "**Treat = 40% Penetration, 2019 ACS Tech Income**", "**Treat = 50% Penetration, 2019 ACS High Tech**", "**Treat = 75% Penetration, 2019 ACS High Tech**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS High Tech.png")


#LOW Tech

ols_2019acs_25_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019acs_40_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019acs_50_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)

ols_2019acs_75_unemployment_lowtech <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_lowtech)


tb1<- tbl_regression(ols_2019acs_25_unemployment_lowtech, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", acs_25_or_more_2020 ~ "Treat (25%, ACS 2019)"))

tb2<- tbl_regression(ols_2019acs_40_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_40_or_more_2020 ~ "Treat (40%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019acs_50_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_50_or_more_2020 ~ "Treat (50%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019acs_75_unemployment_lowtech, label=list(COVID_0_Pre_1_Post ~ "Post COVID", acs_75_or_more_2020 ~ "Treat (75%, ACS 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_ACS <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 ACS Low Tech**", "**Treat = 40% Penetration, 2019 ACS Low Tech**", "**Treat = 50% Penetration, 2019 ACS Low Tech**", "**Treat = 75% Penetration, 2019 ACS Low Tech**"))

gt::gtsave(as_gt(tbl_merge_2019_ACS), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Unempl 2019 ACS Low Tech.png")

```

##ACS, High Service Sector vs Low Service Sector, LAU Unemployment
```{r}

##High Services FCC ACS
ols_2020acs_25_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020acs_40_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020acs_50_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

ols_2020acs_75_unemployment_highservice <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highservice)

tb1 <-
  ols_2020acs_25_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020acs_40_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020acs_50_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020acs_75_unemployment_highservice %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_ACS_Service <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 ACS High Service**", "**Treat = 40% Penetration, 2020 ACS High Service**", "**Treat = 50% Penetration, 2020 ACS High Service**", "**Treat = 75% Penetration, 2020 ACS High Service**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2019 ACS - Subset on Percentage Employed in Service", subtitle = "Above Median Service")

gt::gtsave(tbl_merge_2020_ACS_Service, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 ACS High Service.png")

```

##ACS, HH with Kids vs HH without Kids, LAU Unemployment 

```{r}
#Above Median HH with Kids

ols_2020acs_25_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_25_or_more_2020 + COVID_0_Pre_1_Post*acs_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020acs_40_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_40_or_more_2020 + COVID_0_Pre_1_Post*acs_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020acs_50_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_50_or_more_2020 + COVID_0_Pre_1_Post*acs_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

ols_2020acs_75_unemployment_highkidsunder18 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + acs_75_or_more_2020 + COVID_0_Pre_1_Post*acs_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_highkidsunder18)

tb1 <-
  ols_2020acs_25_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020acs_40_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020acs_50_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020acs_75_unemployment_highkidsunder18 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_ACS_Kids <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 ACS Above Median HH with Kids Under 18**", "**Treat = 40% Penetration, 2020 ACS Above Median HH with Kids Under 18**", "**Treat = 50% Penetration, 2020 ACS Above Median HH with Kids Under 18**", "**Treat = 75% Penetration, 2020 ACS Above Median HH with Kids Under 18**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 ACS - Subset on Households with Kids Under 18", subtitle = "Above Median Households with Kids Under 18")

gt::gtsave(tbl_merge_2020_ACS_Kids, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 ACS Above Median HH with Kids Under 18.png")

```

#2020 Ookla and MLab, LAU Unemployment 

```{r}


ols_2020ookla_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020mlab_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + mlab_50_or_more_2020 + COVID_0_Pre_1_Post*mlab_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2020ookla_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020mlab_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_OoklaMlab <-
  tbl_merge(
    tbls = list(tb1, tb2),
    tab_spanner = c("**Treat = 50% Penetration, 2020 Ookla**", "**Treat = 50% Penetration, 2020 MLab**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 Ookla and MLab", subtitle = "Full Sample")

gt::gtsave(tbl_merge_2020_OoklaMlab, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 Ookla and MLab.png")

```

#Ookla 2020 CT: Ookla 2020 County

```{r}

bb_2020_censustract_IBN$ookla_50_or_more_2020_CT <- ifelse(bb_2020_censustract_IBN$bb_Ookla_2020_download_CT >= 25, 1, 0)

bb_ookla_2020_censustract_totalaccess <- bb_2020_censustract_IBN %>% 
     group_by(GEOID_County) %>% 
     summarise_at(vars(ookla_50_or_more_2020_CT),
               list(sum))

bb_ookla_2020_censustract_totaltracts <- count(bb_2020_censustract_IBN, "GEOID_County")

bb_counties_ookla_2020_percentaccess <- merge(bb_ookla_2020_censustract_totalaccess, bb_ookla_2020_censustract_totaltracts, by = "GEOID_County")

bb_counties_ookla_2020_percentaccess$percentaccess <- bb_counties_ookla_2020_percentaccess$ookla_50_or_more_2020_CT/bb_counties_ookla_2020_percentaccess$freq

keeps <- c("GEOID_County", "percentaccess")
bb_counties_ookla_2020_percentaccess = bb_counties_ookla_2020_percentaccess[keeps]

bb_counties_ookla_2020_percentaccess$ookla_25per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .25, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_40per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .40, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_50per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .50, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_75per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .75, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_85per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .85, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_95per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .95, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_99per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .99, 1, 0)


##Ookla, Census-tracts with access in given counties 

full_df_censustract <- merge(full_df, bb_counties_ookla_2020_percentaccess, by.x="GEOID", by.y="GEOID_County", all.x=TRUE)

full_df_censustract_control <- full_df_censustract[full_df_censustract$ookla_50_or_more_2020== "0",]

full_df_censustract_treatat75CT <- full_df_censustract[full_df_censustract$ookla_75per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat75CT <- rbind(full_df_censustract_control, full_df_censustract_treatat75CT)

full_df_censustract_treatat50CT <- full_df_censustract[full_df_censustract$ookla_50per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat50CT <- rbind(full_df_censustract_control, full_df_censustract_treatat50CT)

full_df_censustract_treatat40CT <- full_df_censustract[full_df_censustract$ookla_40per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat40CT <- rbind(full_df_censustract_control, full_df_censustract_treatat40CT)

full_df_censustract_treatat25CT <- full_df_censustract[full_df_censustract$ookla_25per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat25CT <- rbind(full_df_censustract_control, full_df_censustract_treatat25CT)

var_label(full_df_censustract_treatat75CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat50CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat40CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat25CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above 50 Tracts with Access to 50% BB

ols_2020ookla_50_unemployment_75tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat75CT)

ols_2020ookla_50_unemployment_50tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat50CT)

ols_2020ookla_50_unemployment_40tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat40CT)

ols_2020ookla_50_unemployment_25tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat25CT)

tb1 <-
  ols_2020ookla_50_unemployment_75tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020ookla_50_unemployment_50tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020ookla_50_unemployment_40tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020ookla_50_unemployment_25tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_Ookla_CT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Subset Counties with 75% CT Access**", "**Subset Counties with 50% CT Access**", "**Subset Counties with 40% CT Access**", "**Subset Counties with 25% CT Access**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 Ookla, Treat = 50% Penetration", subtitle = "Split Samples on CT Penetration Rates")

#gtsave(tbl_merge_2020_Ookla_CT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 Ookla CT.png")

```

#ACS 2020 CT: ACS 2020 County

```{r}

bb_2020_censustract_IBN$ookla_50_or_more_2020_CT <- ifelse(bb_2020_censustract_IBN$bb_Ookla_2020_download_CT >= 25, 1, 0)

bb_ookla_2020_censustract_totalaccess <- bb_2020_censustract_IBN %>% 
     group_by(GEOID_County) %>% 
     summarise_at(vars(ookla_50_or_more_2020_CT),
               list(sum))

bb_ookla_2020_censustract_totaltracts <- count(bb_2020_censustract_IBN, "GEOID_County")

bb_counties_ookla_2020_percentaccess <- merge(bb_ookla_2020_censustract_totalaccess, bb_ookla_2020_censustract_totaltracts, by = "GEOID_County")

bb_counties_ookla_2020_percentaccess$percentaccess <- bb_counties_ookla_2020_percentaccess$ookla_50_or_more_2020_CT/bb_counties_ookla_2020_percentaccess$freq

keeps <- c("GEOID_County", "percentaccess")
bb_counties_ookla_2020_percentaccess = bb_counties_ookla_2020_percentaccess[keeps]

bb_counties_ookla_2020_percentaccess$ookla_25per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .25, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_40per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .40, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_50per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .50, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_75per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .75, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_85per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .85, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_95per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .95, 1, 0)

bb_counties_ookla_2020_percentaccess$ookla_99per_counties_or_more_2020 <- ifelse(bb_counties_ookla_2020_percentaccess$percentaccess >= .99, 1, 0)


##Ookla, Census-tracts with access in given counties 

full_df_censustract <- merge(full_df, bb_counties_ookla_2020_percentaccess, by.x="GEOID", by.y="GEOID_County", all.x=TRUE)

full_df_censustract_control <- full_df_censustract[full_df_censustract$ookla_50_or_more_2020== "0",]

full_df_censustract_treatat75CT <- full_df_censustract[full_df_censustract$ookla_75per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat75CT <- rbind(full_df_censustract_control, full_df_censustract_treatat75CT)

full_df_censustract_treatat50CT <- full_df_censustract[full_df_censustract$ookla_50per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat50CT <- rbind(full_df_censustract_control, full_df_censustract_treatat50CT)

full_df_censustract_treatat40CT <- full_df_censustract[full_df_censustract$ookla_40per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat40CT <- rbind(full_df_censustract_control, full_df_censustract_treatat40CT)

full_df_censustract_treatat25CT <- full_df_censustract[full_df_censustract$ookla_25per_counties_or_more_2020== "1" & full_df_censustract$ookla_50_or_more_2020== "1",]

full_df_censustract_treatat25CT <- rbind(full_df_censustract_control, full_df_censustract_treatat25CT)

var_label(full_df_censustract_treatat75CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat50CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat40CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

var_label(full_df_censustract_treatat25CT) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       COVID_0_Pre_1_Post = "COVID (0 = Before, 1 = After)",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       msft_75_or_more_2019 = "Treat = 75%+ w/ MSFT (2019)",
       msft_50_or_more_2019 = "Treat = 50%+ w/ MSFT (2019)",
       msft_40_or_more_2019 = "Treat = 40%+ w/ MSFT (2019)",
       msft_25_or_more_2019 = "Treat = 25%+ w/ MSFT (2019)",
       msft_75_or_more_2020 = "Treat = 75%+ w/ MSFT (2020)",
       msft_50_or_more_2020 = "Treat = 50%+ w/ MSFT (2020)",
       msft_40_or_more_2020 = "Treat = 40%+ w/ MSFT (2020)",
       msft_25_or_more_2020 = "Treat = 25%+ w/ MSFT (2020)",
       fcc_75_or_more_2019 = "Treat = 75%+ w/ FCC (2019)",
       fcc_50_or_more_2019 = "Treat = 50%+ w/ FCC (2019)",
       fcc_40_or_more_2019 = "Treat = 40%+ w/ FCC (2019)",
       fcc_25_or_more_2019 = "Treat = 25%+ w/ FCC (2019)",
       acs_75_or_more_2020 = "Treat = 75%+ w/ ACS (2019)",
       acs_50_or_more_2020 = "Treat = 50%+ w/ ACS (2019)",
       acs_40_or_more_2020 = "Treat = 40%+ w/ ACS (2019)",
       acs_25_or_more_2020 = "Treat = 25%+ w/ ACS (2019)",
       ookla_50_or_more_2020 = "Treat = 50%+ w/ Ookla (2020)",
       mlab_50_or_more_2020 = "Treat = 50%+ w/ MLab (2020)")

#Above 50 Tracts with Access to 50% BB

ols_2020ookla_50_unemployment_75tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat75CT)

ols_2020ookla_50_unemployment_50tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat50CT)

ols_2020ookla_50_unemployment_40tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat40CT)

ols_2020ookla_50_unemployment_25tractaccess <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + ookla_50_or_more_2020 + COVID_0_Pre_1_Post*ookla_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_censustract_treatat25CT)

tb1 <-
  ols_2020ookla_50_unemployment_75tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020ookla_50_unemployment_50tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020ookla_50_unemployment_40tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020ookla_50_unemployment_25tractaccess %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2020_Ookla_CT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Subset Counties with 75% CT Access**", "**Subset Counties with 50% CT Access**", "**Subset Counties with 40% CT Access**", "**Subset Counties with 25% CT Access**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 Ookla, Treat = 50% Penetration", subtitle = "Split Samples on CT Penetration Rates")

#gtsave(tbl_merge_2020_Ookla_CT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 Ookla CT.png")

```

#2020 MSFT, BLS Employment 

```{r}

bls_employment_did <- merge(qcew_employment_2019Q2to2021Q1, county_demo_df_final, by.x = "Area", by.y="Combined Name", all.y=TRUE)

bls_employment_did <- merge(bls_employment_did, bb, by.x = "GEOID", by.y="COUNTY_ID")

bls_employment_did$Employment_Rate_Percent <- bls_employment_did$Employment/bls_employment_did$Total_Pop

#bls_employment_did <- merge(bls_employment_did, break_outs, by.x = "GEOID", by.y="GEOID")

#Starting regressions

ols_2020msft_25_employment <- lm_robust(Employment ~ COVID + msft_25_or_more_2020 + COVID*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = bls_employment_did)

ols_2020msft_40_employment <- lm_robust(Employment ~ COVID + msft_40_or_more_2020 + COVID*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = bls_employment_did)

ols_2020msft_50_employment <- lm_robust(Employment ~ COVID + msft_50_or_more_2020 + COVID*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = bls_employment_did)

ols_2020msft_75_employment <- lm_robust(Employment ~ COVID + msft_75_or_more_2020 + COVID*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = bls_employment_did)

tb1<- tbl_regression(ols_2020msft_25_employment, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID ~ "Post COVID", msft_25_or_more_2020 ~ "Treat (25%, MSFT 2020)"))

tb2<- tbl_regression(ols_2020msft_40_employment, label=list(COVID ~ "Post COVID", msft_40_or_more_2020 ~ "Treat (40%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020msft_50_employment, label=list(COVID ~ "Post COVID", msft_50_or_more_2020 ~ "Treat (50%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020msft_75_employment, label=list(COVID ~ "Post COVID", msft_75_or_more_2020 ~ "Treat (75%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_MSFT <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT**", "**Treat = 40% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 75% Penetration, 2020 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2020_MSFT), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/Regression Empl 2020 MSFT.png")
```


#Robustness Checks

##Descriptive Statistics
```{r}

keeps <- c("Unemployment_Rate_Percent", "ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican")
key_stats_df = full_df[keeps]

stargazer(key_stats_df, type = "text", title="Descriptive statistics", digits=1, out="/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Descriptive Stats/Descriptive Stats.txt",
covariate.labels=c("Unemployment Rate (%)","Education Growth Rate (% 2010 - 2019)","Education Rate (%)","Log of Pop Density (ppl/sq mile)","Black Pop (%)","Hispanic Pop (%)", "Asian Pop (%)", "Native American Pop (%)"))

labs <- c("Unemployment Rate (%)",
          "Education Growth Rate (% 2010 - 2019)",
          "Education Rate (%)",
          "Log of Pop Density (ppl/sq mile)",
          "Black Pop (%)",
          "Hispanic Pop (%)", 
          "Asian Pop (%)", 
          "Native American Pop (%)")

sumtable(key_stats_df,labels=labs)

```

##Histograms
```{r}

## Histogram of Unemployment Rate 

hist(full_df$Unemployment_Rate_Percent, 
     main   = "",  #  Suppress main title 
     breaks = "Scott",  # Use the "bins" vector to determine the x axis bins 
     axes   = TRUE, # turn off axes
     col    = "grey", # make data grey
     xlab   = "", # turn off x axis label
     ylab   = "" ) # turn off y axis label

# label axis and title
mtext("Frequency", side = 2, line = 3, las = 0, cex = 1) # label y axis
mtext("Unemployment Rate Percent", side = 1, line = 3, las = 0, cex = 1) # label x axis
title("Unemployment Rate") # title for subplot

# Plot the Log Unemployment Rate histogram
hist(log(full_df$Unemployment_Rate_Percent), 
     main   = "",  #  Suppress main title 
     breaks = "Scott",  # Use the "bins" vector to determine the x axis bins 
     axes   = TRUE, # turn off axes
     col    = "grey", # make data grey
     xlab   = "", # turn off x axis label
     ylab   = "" ) # turn off y axis label

# label axis and title
mtext("Frequency", side = 2, line = 3, las = 0, cex = 1) # label y axis
mtext("Log of Unemployment Rate Percent", side = 1, line = 3, las = 0, cex = 1) # label x axis
title("Log of Unemployment Rate") # title for subplot

qqPlot(full_df$Unemployment_Rate_Percent, ylab = "Unemployment Rate")
qqPlot(log(full_df$Unemployment_Rate_Percent), ylab = "Log Unemployment Rate")


full_df_log$predicted_olsMSFT502020 <- predict(ols_2020msft_50_unemployment)   # Save the predicted values
full_df_log$residuals_olsMSFT502020 <- residuals(ols_2020msft_50_unemployment)   #Save the residual values

# set plot parameters

plot(full_df_log$predicted_olsMSFT252020,full_df_log$residuals_olsMSFT252020,
     ylab="Residuals", xlab="Unemployment",
     main="Mincer type model")

full_df_log$predicted_olsMSFT502020_log <- predict(ols_2020msft_50_unemployment_log)   # Save the predicted values
full_df_log$residuals_olsMSFT502020_log <- residuals(ols_2020msft_50_unemployment_log)   #Save the residual values

# set plot parameters

plot(full_df_log$predicted_olsMSFT502020_log,full_df_log$residuals_olsMSFT502020_log,
     ylab="Residuals", xlab="Log Unemployment",
     main="Mincer type model")

qqPlot(full_df_log$residuals_olsMSFT252020, ylab = "Residual Unemployment Rate")
qqPlot(full_df_log$residuals_olsMSFT502020_log , ylab = "Residual Log Unemployment Rate")


keeps <- c("Unemployment_Rate_Percent", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican", "log_pop_density", "ed_growth_rate", "percent_ed")
full_df_summary = full_df[keeps]

res <- stat.desc(full_df_summary)
round(res, 2)
write_xlsx(res, "/Users/nikkivandenHeever/Desktop/res.xlsx")

keeps <- c("bb_MSFT_Nov2019", "bb_MSFT_Oct2020", "bb_FCC_2019_AnnualReport", "bb_ACS_2019")
bb_summary = bb[keeps]

res <- stat.desc(bb_summary)
round(res, 2)
write_xlsx(res, "/Users/nikkivandenHeever/Desktop/res_bb.xlsx")


ols_2020msft_50_unemployment_FE <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period) + factor(GEOID), data = full_df)

```

##Correlation Matrix

```{r}

keeps <- c("percent_black", "percent_natamerican", "percent_asian", "percent_hispanic", "log_pop_density", "Unemployment_Rate_Percent", "ed_growth_rate", "percent_ed","NewHouseUnits_Above1_Below0", "BridgeCount_Above1_Below0", "Urban_1_Rural_0", "income_below_0_above_1", "HighTech_Below_0_Above_1", "Services_Below_0_Above_1", "PercentEssential_BelowMedian_0_AboveMedian_1", "KidsUnder18_Below_0_Above_1", "SingleParent_Below_0_Above_1")

corr_matrix = full_df[keeps]

var_label(corr_matrix) <- 
  list(percent_black = "Percent Pop Black",
       percent_natamerican = "Percent Pop Native American",
       percent_asian = "Percent Pop Asian",
       percent_hispanic = "Percent Pop Hispanic",
       log_pop_density = "Log Pop Density",
       Unemployment_Rate_Percent = "Unemployment Rate",
       ed_growth_rate = "Growth Rate of Pop (25+) w/BS",
       percent_ed = "Percent Pop (25+) w/BS", 
       NewHouseUnits_Above1_Below0 = "New Housing Units Binary",
       BridgeCount_Above1_Below0 = "Bridge Density Binary",
       Urban_1_Rural_0 = "Urban vs Rural Binary",
       income_below_0_above_1 = "Income Binary", 
       HighTech_Below_0_Above_1 = "Tech Sector Binary",
       Services_Below_0_Above_1 = "Service Sector Binary",
       PercentEssential_BelowMedian_0_AboveMedian_1 = "Essential Industry Workers Binary", 
       KidsUnder18_Below_0_Above_1 = "Children Under 18 Binary",
       SingleParent_Below_0_Above_1 = "Single Parents Binary")

#Code from: http://www.sthda.com/english/wiki/elegant-correlation-table-using-xtable-r-package

# x is a matrix containing the data
# method : correlation method. "pearson"" or "spearman"" is supported
# removeTriangle : remove upper or lower triangle
# results :  if "html" or "latex"
  # the results will be displayed in html or latex format

corstars <-function(x, method=c("pearson", "spearman"), removeTriangle=c("upper", "lower"),
                     result=c("none", "html", "latex")){
    #Compute correlation matrix
    require(Hmisc)
    x <- as.matrix(x)
    correlation_matrix<-rcorr(x, type=method[1])
    R <- correlation_matrix$r # Matrix of correlation coeficients
    p <- correlation_matrix$P # Matrix of p-value 
    
    ## Define notions for significance levels; spacing is important.
    mystars <- ifelse(p < .0001, "****", ifelse(p < .001, "*** ", ifelse(p < .01, "**  ", ifelse(p < .05, "*   ", "    "))))
    
    ## trunctuate the correlation matrix to two decimal
    R <- format(round(cbind(rep(-1.11, ncol(x)), R), 2))[,-1]
    
    ## build a new matrix that includes the correlations with their apropriate stars
    Rnew <- matrix(paste(R, mystars, sep=""), ncol=ncol(x))
    diag(Rnew) <- paste(diag(R), " ", sep="")
    rownames(Rnew) <- colnames(x)
    colnames(Rnew) <- paste(colnames(x), "", sep="")
    
    ## remove upper triangle of correlation matrix
    if(removeTriangle[1]=="upper"){
      Rnew <- as.matrix(Rnew)
      Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
      Rnew <- as.data.frame(Rnew)
    }
    
    ## remove lower triangle of correlation matrix
    else if(removeTriangle[1]=="lower"){
      Rnew <- as.matrix(Rnew)
      Rnew[lower.tri(Rnew, diag = TRUE)] <- ""
      Rnew <- as.data.frame(Rnew)
    }
    
    ## remove last column and return the correlation matrix
    Rnew <- cbind(Rnew[1:length(Rnew)-1])
    if (result[1]=="none") return(Rnew)
    else{
      if(result[1]=="html") print(xtable(Rnew), type="html")
      else print(xtable(Rnew), type="latex") 
    }
} 

correlation_matrix <- corstars(corr_matrix, method="pearson", removeTriangle="upper")


```

##Simplified Base Case

```{r}

ols_2020msft_50_unemployment <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_50_unemployment_simp <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020, clusters = state, data = full_df)

ols_2020msft_50_unemployment_FE <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + factor(GEOID) + factor(Time), data = full_df)

tb1 <-
  ols_2020msft_50_unemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_50_unemployment_simp %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)


tbl_merge_2020_MSFT_Simplified <- tbl_merge(
  list(tb1, tb2),
  tab_spanner = c("**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT", subtitle = "Using CEM")

gt::gtsave(tbl_merge_2020_MSFT_Simplified, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Simplified.png")

```

##2020 MSFT, Log of LAU Unemployment 

```{r}

full_df$log_unemployment <- ln(full_df$Unemployment_Rate_Percent)

ols_2020msft_25_logunemployment <- lm_robust(log_unemployment ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_40_logunemployment <- lm_robust(log_unemployment ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_50_logunemployment <- lm_robust(log_unemployment ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

ols_2020msft_75_logunemployment <- lm_robust(log_unemployment ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df)

tb1 <-
  ols_2020msft_25_logunemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_2020msft_40_logunemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_2020msft_50_logunemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_2020msft_75_logunemployment %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT**", "**Treat = 40% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 75% Penetration, 2020 MSFT**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "2020 MSFT", subtitle = "Full Set with Log Unemployment")

gt::gtsave(tbl_merge_2019_MSFT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2019 MSFT Log Unemployment.png")

```

##MSFT, Only In Treatement, LAU Unemployment

```{r}
full_df_intreat25 <- full_df[full_df$MSFT_nonchange_25== "1",]

full_df_intreat40 <- full_df[full_df$MSFT_nonchange_40== "1",]

full_df_intreat50 <- full_df[full_df$MSFT_nonchange_50== "1",]

full_df_intreat75 <- full_df[full_df$MSFT_nonchange_75== "1",]

ols_msft_unemployment_intreat25 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_intreat25)

ols_msft_unemployment_intreat40 <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_intreat40)

ols_msft_unemployment_intreat50 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_intreat50)

ols_msft_unemployment_intreat75 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = full_df_intreat75)

tb1 <-
  ols_msft_unemployment_intreat25 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  ols_msft_unemployment_intreat40 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb3 <-
  ols_msft_unemployment_intreat50 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb4 <-
  ols_msft_unemployment_intreat75 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tbl_merge_2019_MSFT <- tbl_merge(
  list(tb1, tb2, tb3, tb4),
  tab_spanner = c("**Treat = 25% Penetration, MSFT In Treat**", "**Treat = 40% Penetration, MSFT In Treat**", "**Treat = 50% Penetration, MSFT In Treat**", "**Treat = 75% Penetration, MSFT In Treat**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Difference-in-Difference regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
    gt::tab_header(title = "MSFT In Treat Between 2019 and 2020", subtitle = "Full Set")

gt::gtsave(tbl_merge_2019_MSFT, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/MSFT In Treat.png")

```

## COVID in April

```{r}

#LAU

LAU_employment_2019Novto2020Dec_sensitivity <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Classes/Spring/19703 and 19704 Applied Data Analysis 1 and 2/Project/Data/BLS/LAU_County_Nov2019Dec2020_sensitivity.xlsx")

LAU_employment_2019Julyto2020Dec_sensitivity <- rbind(LAU_employment_2019Julyto2019Oct, LAU_employment_2019Novto2020Dec_sensitivity)

full_df_sensitivity <- merge(LAU_employment_2019Julyto2020Dec_sensitivity, county_demo_df, by.x = "GEOID", by.y="GEOID")

full_df_sensitivity <- merge(full_df_sensitivity, bb, by.x = "GEOID", by.y="COUNTY_ID")

full_df_sensitivity <- merge(full_df_sensitivity, break_outs, by.x = "GEOID", by.y="GEOID")

full_df_sensitivity$Black_Below_0_Above_1 <- ifelse(full_df_sensitivity$percent_black >= median(full_df_sensitivity$percent_black), 1, 0)

full_df_sensitivity$Hispanic_Below_0_Above_1 <- ifelse(full_df_sensitivity$percent_hispanic >= median(full_df_sensitivity$percent_hispanic), 1, 0)

ols_2019msft_25_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2019msft_40_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2019msft_50_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2019msft_75_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)


tb1<- tbl_regression(ols_2019msft_25_unemployment_sensitivity, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_25_or_more_2019 ~ "Treat (25%, MSFT 2019)"))

tb2<- tbl_regression(ols_2019msft_40_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_40_or_more_2019 ~ "Treat (40%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019msft_50_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2019 ~ "Treat (50%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019msft_75_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_75_or_more_2019 ~ "Treat (75%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_MSFT_Sensitivity <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT**", "**Treat = 40% Penetration, 2019 MSFT**", "**Treat = 50% Penetration, 2019 MSFT**", "**Treat = 75% Penetration, 2019 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2019_MSFT_Sensitivity), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2019 MSFT Sensitivity to COVID in April.png")

ols_2020msft_25_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2020msft_40_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2020msft_50_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

ols_2020msft_75_unemployment_sensitivity <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_sensitivity)

tb1<- tbl_regression(ols_2020msft_25_unemployment_sensitivity, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_25_or_more_2020 ~ "Treat (25%, MSFT 2020)"))

tb2<- tbl_regression(ols_2020msft_40_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_40_or_more_2020 ~ "Treat (40%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020msft_50_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2020 ~ "Treat (50%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020msft_75_unemployment_sensitivity, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_75_or_more_2020 ~ "Treat (75%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_MSFT_Sensitivity <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT**", "**Treat = 40% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 75% Penetration, 2020 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2020_MSFT_Sensitivity), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2019 MSFT Sensitivity to COVID in April.png")

```

## t-tests
```{r}

full_df_ttest_treat <- full_df[full_df$msft_50_or_more_2019== "1" & full_df$COVID_0_Pre_1_Post== "0",]

full_df_ttest_control <- full_df[full_df$msft_50_or_more_2019== "0" & full_df$COVID_0_Pre_1_Post== "0",]

t.test(full_df_ttest_treat$Unemployment_Rate_Percent, full_df_ttest_control$Unemployment_Rate_Percent)

full_df_ttest_treat_post <- full_df[full_df$msft_50_or_more_2019== "1" & full_df$COVID_0_Pre_1_Post== "1",]

full_df_ttest_control_post <- full_df[full_df$msft_50_or_more_2019== "0" & full_df$COVID_0_Pre_1_Post== "1",]

t.test(full_df_ttest_treat_post$Unemployment_Rate_Percent, full_df_ttest_control_post$Unemployment_Rate_Percent)

#MSFT 2020 Treat
full_df_treat_plot <- full_df[full_df$msft_50_or_more_2020 == "1",]

full_df_treat_plot = full_df_treat_plot[keeps]

full_df_treat_plot <- full_df_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_plot <- full_df_treat_plot[, col_order]

write.xlsx(full_df_treat_plot, "/Users/nikkivandenHeever/Desktop/treat.xlsx")

full_df_treat_mean <- colMeans(full_df_treat_plot) 

full_df_treat_stdev <- sapply(full_df_treat_plot,sd)

write.xlsx(full_df_treat_mean, "/Users/nikkivandenHeever/Desktop/mean.xlsx")
write.xlsx(full_df_treat_stdev, "/Users/nikkivandenHeever/Desktop/stdev.xlsx")

#MSFT 2020 Control
full_df_control_plot <- full_df[full_df$msft_50_or_more_2020 == "0",]

full_df_control_plot = full_df_control_plot[keeps]

full_df_control_plot <- full_df_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_control_plot <- full_df_control_plot[, col_order]

write.xlsx(full_df_control_plot, "/Users/nikkivandenHeever/Desktop/control.xlsx")

full_df_control_mean <- colMeans(full_df_control_plot) 

full_df_control_stdev <- sapply(full_df_control_plot,sd)

write.xlsx(full_df_control_mean, "/Users/nikkivandenHeever/Desktop/mean_control.xlsx")
write.xlsx(full_df_control_stdev, "/Users/nikkivandenHeever/Desktop/stdev_control.xlsx")


## Just for pre-trend
Look at the insitutional trends papers 

Show some examples 

Show pre-trend t-tests and justify 
For CEM, show t-tests (for mean) and ks-tests (for distribution)

Will want to see impbalance betweeen the full sample and the reduced sample 
Look at Daniel's code

```

##Just Interaction Terms

```{r}

ols_2020msft_50_unemployment_simple <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020, clusters = state, data = full_df)


tb1<- tbl_regression(ols_2020msft_50_unemployment_simple1, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2020 ~ "Treat (50%, MSFT 2020)"))

tb2<- tbl_regression(ols_2019fcc_50_unemployment_simple1, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2020"))

tbl_merge_2020_MSFT_FCC_simple1 <-
  tbl_merge(
    tbls = list(tb1, tb2),
    tab_spanner = c("**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2019 FCC**"))

gt::gtsave(as_gt(tbl_merge_2020_MSFT_FCC_simple1), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2020 MSFT 2019 FCC Simple 1.png")
```

##FE Included

```{r}

ols_2020msft_50_unemployment_FE <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period) + factor(state), data = full_df)

ols_2020msft_50_unemployment_FEtime <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period), data = full_df)

ols_2020msft_50_unemployment_FEstate <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(state), data = full_df)

ols_2019fcc_50_unemployment_FE <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period) + factor(state), data = full_df)

ols_2019fcc_50_unemployment_FEtime <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period), data = full_df)

ols_2019fcc_50_unemployment_FEstate <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + fcc_50_or_more_2019 + COVID_0_Pre_1_Post*fcc_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican + factor(Period) + factor(GEOID), data = full_df)

tb1<- tbl_regression(ols_2020msft_50_unemployment_FE, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2020 ~ "Treat (50%, MSFT 2020)"))

tb2<- tbl_regression(ols_2019fcc_50_unemployment_FE, label=list(COVID_0_Pre_1_Post ~ "Post COVID", fcc_50_or_more_2019 ~ "Treat (50%, FCC 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tbl_merge_2020_MSFT_FCC_FE <-
  tbl_merge(
    tbls = list(tb1, tb2),
    tab_spanner = c("**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2019 FCC**"))

gt::gtsave(as_gt(tbl_merge_2020_MSFT_FCC_FE), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2020 MSFT 2019 FCC FE.png")



```

##Pie Chart for Unserved Areas
```{r}

county_access_income_demographics <- merge(county_demo_df, bb, by.x="GEOID", by.y="COUNTY_ID", all.y=TRUE)

county_access_income_demographics <- merge(county_access_income_demographics, county_income, by.x="GEOID", by.y="FIPS_Code", all.x=TRUE)

county_access_income_demographics_belowfcc2019 <- county_access_income_demographics[county_access_income_demographics$fcc_50_or_more_2019 == "0",]

write_xlsx(county_access_income_demographics_belowfcc2019, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowfcc2019.xlsx")

county_access_income_demographics_belowmsft2019 <- county_access_income_demographics[county_access_income_demographics$msft_50_or_more_2019 == "0",]

write_xlsx(county_access_income_demographics_belowmsft2019, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowmsft2019.xlsx")

county_access_income_demographics_belowmsft2020 <- county_access_income_demographics[county_access_income_demographics$msft_50_or_more_2020 == "0",]

write_xlsx(county_access_income_demographics_belowmsft2020, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowmsft2020.xlsx")

county_access_income_demographics_abovemsft2020 <- county_access_income_demographics[county_access_income_demographics$msft_50_or_more_2020 == "1",]

write_xlsx(county_access_income_demographics_abovemsft2020, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_abovemsft2020.xlsx")

county_access_income_demographics_belowacs2020 <- county_access_income_demographics[county_access_income_demographics$acs_50_or_more_2020 == "0",]

write_xlsx(county_access_income_demographics_belowacs2020, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowacs2020.xlsx")

county_access_income_demographics_belowookla2020 <- county_access_income_demographics[county_access_income_demographics$ookla_50_or_more_2020 == "0",]

write_xlsx(county_access_income_demographics_belowookla2020, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowookla2020.xlsx")

county_access_income_demographics_belowmlab2020 <- county_access_income_demographics[county_access_income_demographics$mlab_50_or_more_2020 == "0",]

write_xlsx(county_access_income_demographics_belowmlab2020, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2021 NSF Rapid/Actual Data/Broadband Data/county_access_income_demographics_belowmlab2020.xlsx")



```

#Plots  of Parallel Trends

##MSFT 2020 Treat - Unemployment
```{r}

keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020")

full_df_treat_plot <- full_df[full_df$msft_50_or_more_2020 == "1",]

full_df_treat_plot = full_df_treat_plot[keeps]

full_df_treat_plot <- full_df_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_plot <- full_df_treat_plot[, col_order]

full_df_treat_plot <- colMeans(full_df_treat_plot) 

write.xlsx(full_df_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/Treat Test.xlsx")

```

##MSFT 2020 Control - Unemployment
```{r}
full_df_control_plot <- full_df[full_df$msft_50_or_more_2020 == "0",]

full_df_control_plot = full_df_control_plot[keeps]

full_df_control_plot <- full_df_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_control_plot <- full_df_control_plot[, col_order]

full_df_control_plot <- colMeans(full_df_control_plot) 

write.xlsx(full_df_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Control.xlsx")
```

##MSFT 2020 Treat - Employment
```{r}

keeps <- c("GEOID", "Period", "Employment")

col_order <- c("2019-04-01", "2019-05-01", "2019-06-01","2019-07-01", "2019-08-01", "2019-09-01", "2019-10-01", "2019-11-01", "2019-12-01", "2020-01-01", "2020-02-01", "2020-03-01", "2020-04-01", "2020-05-01", "2020-06-01", "2020-07-01", "2020-08-01", "2020-09-01", "2020-10-01", "2020-11-01", "2020-12-01", "2021-01-01", "2021-02-01", "2021-03-01") 

bls_employment_did_treat_plot <- bls_employment_did[bls_employment_did$msft_50_or_more_2020 == "1",]

bls_employment_did_treat_plot = bls_employment_did_treat_plot[keeps]

bls_employment_did_treat_plot <- bls_employment_did_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Employment)

bls_employment_did_treat_plot <- bls_employment_did_treat_plot[, col_order]

bls_employment_did_treat_plot <- na.omit(bls_employment_did_treat_plot)

bls_employment_did_treat_plot <- colMeans(bls_employment_did_treat_plot) 

write.xlsx(bls_employment_did_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/MSFT Employed Treat.xlsx")

```

##MSFT 2020 Control - Employment
```{r}
bls_employment_did_control_plot <- bls_employment_did[bls_employment_did$msft_50_or_more_2020 == "0",]

bls_employment_did_control_plot = bls_employment_did_control_plot[keeps]

bls_employment_did_control_plot <- bls_employment_did_control_plot %>%
  pivot_wider(names_from = Period, values_from = Employment)

bls_employment_did_control_plot <- bls_employment_did_control_plot[, col_order]

bls_employment_did_control_plot <- na.omit(bls_employment_did_control_plot)

bls_employment_did_control_plot <- colMeans(bls_employment_did_control_plot) 

write.xlsx(bls_employment_did_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/MSFT Employed Control.xlsx")
```


##MSFT 2020 90/80/70/60/50 Splits 
```{r}
#Re-integrate these into the base BB dataset 

keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020", "11/1/2020", "12/1/2020")

full_df$msft_90_or_more_2020 <- ifelse(full_df$bb_MSFT_Oct2020 >= .90, 1, 0)

full_df$msft_80_or_more_2020 <- ifelse(full_df$bb_MSFT_Oct2020 >= .80, 1, 0)

full_df$msft_70_or_more_2020 <- ifelse(full_df$bb_MSFT_Oct2020 >= .70, 1, 0)

full_df$msft_60_or_more_2020 <- ifelse(full_df$bb_MSFT_Oct2020 >= .60, 1, 0)

full_df_treat_90_plot <- full_df[full_df$msft_90_or_more_2020 == "1",]

full_df_treat_90_plot = full_df_treat_90_plot[keeps]

full_df_treat_90_plot <- full_df_treat_90_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_90_plot <- full_df_treat_90_plot[, col_order]

full_df_treat_90_plot <- colMeans(full_df_treat_90_plot) 

write.xlsx(full_df_treat_90_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Treat 90%.xlsx")

full_df_treat_80_plot <- full_df[full_df$msft_80_or_more_2020 == "1",]

full_df_treat_80_plot = full_df_treat_80_plot[keeps]

full_df_treat_80_plot <- full_df_treat_80_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_80_plot <- full_df_treat_80_plot[, col_order]

full_df_treat_80_plot <- colMeans(full_df_treat_80_plot) 

write.xlsx(full_df_treat_80_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Treat 80%.xlsx")

full_df_treat_70_plot <- full_df[full_df$msft_70_or_more_2020 == "1",]

full_df_treat_70_plot = full_df_treat_70_plot[keeps]

full_df_treat_70_plot <- full_df_treat_70_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_70_plot <- full_df_treat_70_plot[, col_order]

full_df_treat_70_plot <- colMeans(full_df_treat_70_plot) 

write.xlsx(full_df_treat_70_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Treat 70%.xlsx")

full_df_treat_60_plot <- full_df[full_df$msft_60_or_more_2020 == "1",]

full_df_treat_60_plot = full_df_treat_60_plot[keeps]

full_df_treat_60_plot <- full_df_treat_60_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_60_plot <- full_df_treat_60_plot[, col_order]

full_df_treat_60_plot <- colMeans(full_df_treat_60_plot) 

write.xlsx(full_df_treat_60_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Treat 60%.xlsx")



```

##MSFT 2020 Urban Treat
```{r}
full_df_urban_treat_plot <- full_df[full_df$'100Rural_0_Urban_1'== "1" & full_df$msft_50_or_more_2020 == "1",]

keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")
full_df_urban_treat_plot = full_df_urban_treat_plot[keeps]

full_df_urban_treat_plot <- full_df_urban_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020", "11/1/2020", "12/1/2020")
full_df_urban_treat_plot <- full_df_urban_treat_plot[, col_order]

full_df_urban_treat_plot <- colMeans(full_df_urban_treat_plot) 

write.xlsx(full_df_urban_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/Urban_Treat.xlsx")

```

##MSFT 2020 Urban Control
```{r}
full_df_urban_control_plot <- full_df[full_df$'100Rural_0_Urban_1'== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_urban_control_plot = full_df_urban_control_plot[keeps]

full_df_urban_control_plot <- full_df_urban_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_urban_control_plot <- full_df_urban_control_plot[, col_order]

full_df_urban_control_plot <- colMeans(full_df_urban_control_plot) 

write.xlsx(full_df_urban_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/Urban_Control.xlsx")

```


##MSFT 2020 Rural Treat
```{r}
full_df_rural_treat_plot <- full_df[full_df$'100Rural_0_Urban_1'== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_rural_treat_plot = full_df_rural_treat_plot[keeps]

full_df_rural_treat_plot <- full_df_rural_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_rural_treat_plot <- full_df_rural_treat_plot[, col_order]

full_df_rural_treat_plot <- colMeans(full_df_rural_treat_plot) 

write.xlsx(full_df_rural_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/Rural_Treat.xlsx")
```


##MSFT 2020 Rural Control
```{r}
full_df_rural_control_plot <- full_df[full_df$'100Rural_0_Urban_1'== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_rural_control_plot = full_df_rural_control_plot[keeps]

full_df_rural_control_plot <- full_df_rural_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_rural_control_plot <- full_df_rural_control_plot[, col_order]

full_df_rural_control_plot <- colMeans(full_df_rural_control_plot) 

write.xlsx(full_df_rural_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/Rural_Control.xlsx")
```


##MSFT 2020 High Income Treat
```{r}
full_df_highincome_treat_plot <- full_df[full_df$MedianHHIncome_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highincome_treat_plot = full_df_highincome_treat_plot[keeps]

full_df_highincome_treat_plot <- full_df_highincome_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highincome_treat_plot <- full_df_highincome_treat_plot[, col_order]

full_df_highincome_treat_plot <- colMeans(full_df_highincome_treat_plot) 

write.xlsx(full_df_highincome_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighIncome_Treat.xlsx")
```

##MSFT 2020 High Income Control
```{r}
full_df_highincome_control_plot <- full_df[full_df$MedianHHIncome_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highincome_control_plot = full_df_highincome_control_plot[keeps]

full_df_highincome_control_plot <- full_df_highincome_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highincome_control_plot <- full_df_highincome_control_plot[, col_order]

full_df_highincome_control_plot <- colMeans(full_df_highincome_control_plot) 

write.xlsx(full_df_highincome_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighIncome_Control.xlsx")
```

##MSFT 2020 Low Income Treat
```{r}
full_df_lowincome_treat_plot <- full_df[full_df$MedianHHIncome_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowincome_treat_plot = full_df_lowincome_treat_plot[keeps]

full_df_lowincome_treat_plot <- full_df_lowincome_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowincome_treat_plot <- full_df_lowincome_treat_plot[, col_order]

full_df_lowincome_treat_plot <- colMeans(full_df_lowincome_treat_plot) 

write.xlsx(full_df_lowincome_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowIncome_Treat.xlsx")
```

```{r}
#MSFT 2020 Low Income Control
full_df_lowincome_control_plot <- full_df[full_df$MedianHHIncome_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowincome_control_plot = full_df_lowincome_control_plot[keeps]

full_df_lowincome_control_plot <- full_df_lowincome_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowincome_control_plot <- full_df_lowincome_control_plot[, col_order]

full_df_lowincome_control_plot <- colMeans(full_df_lowincome_control_plot) 

write.xlsx(full_df_lowincome_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowIncome_Control.xlsx")
```


##MSFT 2020 High EID Treat
```{r}
full_df_highEID_treat_plot <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highEID_treat_plot = full_df_highEID_treat_plot[keeps]

full_df_highEID_treat_plot <- full_df_highEID_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highEID_treat_plot <- full_df_highEID_treat_plot[, col_order]

full_df_highEID_treat_plot <- colMeans(full_df_highEID_treat_plot) 

write.xlsx(full_df_highEID_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighEID_Treat.xlsx")
```


##MSFT 2020 High EID Control
```{r}
full_df_highEID_control_plot <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highEID_control_plot = full_df_highEID_control_plot[keeps]

full_df_highEID_control_plot <- full_df_highEID_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highEID_control_plot <- full_df_highEID_control_plot[, col_order]

full_df_highEID_control_plot <- colMeans(full_df_highEID_control_plot) 

write.xlsx(full_df_highEID_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighEID_Control.xlsx")
```


##MSFT 2020 Low EID Treat
```{r}
full_df_lowEID_treat_plot <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowEID_treat_plot = full_df_lowEID_treat_plot[keeps]

full_df_lowEID_treat_plot <- full_df_lowEID_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowEID_treat_plot <- full_df_lowEID_treat_plot[, col_order]

full_df_lowEID_treat_plot <- colMeans(full_df_lowEID_treat_plot) 

write.xlsx(full_df_lowEID_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowEID_Treat.xlsx")
```

##MSFT 2020 Low EID Control
```{r}
full_df_lowEID_control_plot <- full_df[full_df$PercentEssential_BelowMedian_0_AboveMedian_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowEID_control_plot = full_df_lowEID_control_plot[keeps]

full_df_lowEID_control_plot <- full_df_lowEID_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowEID_control_plot <- full_df_lowEID_control_plot[, col_order]

full_df_lowEID_control_plot <- colMeans(full_df_lowEID_control_plot) 

write.xlsx(full_df_lowEID_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowEID_Control.xlsx")
```


##MSFT 2020 High Black Treat
```{r}
full_df_highblack_treat_plot <- full_df[full_df$Black_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highblack_treat_plot = full_df_highblack_treat_plot[keeps]

full_df_highblack_treat_plot <- full_df_highblack_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highblack_treat_plot <- full_df_highblack_treat_plot[, col_order]

full_df_highblack_treat_plot <- colMeans(full_df_highblack_treat_plot) 

write.xlsx(full_df_highblack_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighBlack_Treat.xlsx")
```


##MSFT 2020 High Black Control
```{r}
full_df_highBlack_control_plot <- full_df[full_df$Black_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highBlack_control_plot = full_df_highBlack_control_plot[keeps]

full_df_highBlack_control_plot <- full_df_highBlack_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highBlack_control_plot <- full_df_highBlack_control_plot[, col_order]

full_df_highBlack_control_plot <- colMeans(full_df_highBlack_control_plot) 

write.xlsx(full_df_highBlack_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighBlack_Control.xlsx")
```


##MSFT 2020 Low Black Treat
```{r}
full_df_lowblack_treat_plot <- full_df[full_df$Black_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowblack_treat_plot = full_df_lowblack_treat_plot[keeps]

full_df_lowblack_treat_plot <- full_df_lowblack_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowblack_treat_plot <- full_df_lowblack_treat_plot[, col_order]

full_df_lowblack_treat_plot <- colMeans(full_df_lowblack_treat_plot) 

write.xlsx(full_df_lowblack_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowBlack_Treat.xlsx")
```

##MSFT 2020 Low Black Control
```{r}
full_df_lowBlack_control_plot <- full_df[full_df$Black_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowBlack_control_plot = full_df_lowBlack_control_plot[keeps]

full_df_lowBlack_control_plot <- full_df_lowBlack_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowBlack_control_plot <- full_df_lowBlack_control_plot[, col_order]

full_df_lowBlack_control_plot <- colMeans(full_df_lowBlack_control_plot) 

write.xlsx(full_df_lowBlack_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowBlack_Control.xlsx")
```

##MSFT 2020 High Hispanic Treat
```{r}
full_df_highhispanic_treat_plot <- full_df[full_df$Hispanic_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highhispanic_treat_plot = full_df_highhispanic_treat_plot[keeps]

full_df_highhispanic_treat_plot <- full_df_highhispanic_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highhispanic_treat_plot <- full_df_highhispanic_treat_plot[, col_order]

full_df_highhispanic_treat_plot <- colMeans(full_df_highhispanic_treat_plot) 

write.xlsx(full_df_highhispanic_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighHispanic_Treat.xlsx")
```

##MSFT 2020 High Hispanic Control
```{r}
full_df_highHispanic_control_plot <- full_df[full_df$Hispanic_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highHispanic_control_plot = full_df_highHispanic_control_plot[keeps]

full_df_highHispanic_control_plot <- full_df_highHispanic_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highHispanic_control_plot <- full_df_highHispanic_control_plot[, col_order]

full_df_highHispanic_control_plot <- colMeans(full_df_highHispanic_control_plot) 

write.xlsx(full_df_highHispanic_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighHispanic_Control.xlsx")
```


##MSFT 2020 Low Hispanic Treat
```{r}
full_df_lowhispanic_treat_plot <- full_df[full_df$Hispanic_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowhispanic_treat_plot = full_df_lowhispanic_treat_plot[keeps]

full_df_lowhispanic_treat_plot <- full_df_lowhispanic_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowhispanic_treat_plot <- full_df_lowhispanic_treat_plot[, col_order]

full_df_lowhispanic_treat_plot <- colMeans(full_df_lowhispanic_treat_plot) 

write.xlsx(full_df_lowhispanic_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowHispanic_Treat.xlsx")
```


##MSFT 2020 Low Hispanic Control
```{r}
full_df_lowHispanic_control_plot <- full_df[full_df$Hispanic_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowHispanic_control_plot = full_df_lowHispanic_control_plot[keeps]

full_df_lowHispanic_control_plot <- full_df_lowHispanic_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowHispanic_control_plot <- full_df_lowHispanic_control_plot[, col_order]

full_df_lowHispanic_control_plot <- colMeans(full_df_lowHispanic_control_plot) 

write.xlsx(full_df_lowHispanic_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowHispanic_Control.xlsx")
```

##MSFT 2020 High Tech Treat
```{r}
full_df_hightech_treat_plot <- full_df[full_df$HighTech_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_hightech_treat_plot = full_df_hightech_treat_plot[keeps]

full_df_hightech_treat_plot <- full_df_hightech_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_hightech_treat_plot <- full_df_hightech_treat_plot[, col_order]

full_df_hightech_treat_plot <- colMeans(full_df_hightech_treat_plot) 

write.xlsx(full_df_hightech_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighTech_Treat.xlsx")
```

##MSFT 2020 High Tech Control
```{r}
full_df_hightech_control_plot <- full_df[full_df$HighTech_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_hightech_control_plot = full_df_hightech_control_plot[keeps]

full_df_hightech_control_plot <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighTech_Control.xlsx")

full_df_hightech_control_plot <- full_df_hightech_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_hightech_control_plot <- full_df_hightech_control_plot[, col_order]

full_df_hightech_control_plot <- colMeans(full_df_hightech_control_plot) 

write.xlsx(full_df_hightech_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/HighTech_Control.xlsx")
```

##MSFT 2020 Low Tech Treat
```{r}
full_df_lowtech_treat_plot <- full_df[full_df$HighTech_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowtech_treat_plot = full_df_lowtech_treat_plot[keeps]

full_df_lowtech_treat_plot <- full_df_lowtech_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowtech_treat_plot <- full_df_lowtech_treat_plot[, col_order]

full_df_lowtech_treat_plot <- colMeans(full_df_lowtech_treat_plot) 

write.xlsx(full_df_lowtech_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowTech_Treat.xlsx")
```

##MSFT 2020 Low Tech Control  - COME BACK TO
```{r}
full_df_lowtech_control_plot <- full_df[full_df$HighTech_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowtech_control_plot = full_df_lowtech_control_plot[keeps]

full_df_lowtech_control_plot <- read_xlsx("/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowTech_Control.xlsx")

full_df_lowtech_control_plot <- full_df_lowtech_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowtech_control_plot <- full_df_lowtech_control_plot[, col_order]

full_df_lowtech_control_plot <- colMeans(full_df_lowtech_control_plot) 

write.xlsx(full_df_lowtech_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Parallel Trend Graphics/LowTech_Control.xlsx")
```


##MSFT 2020 High Service Treat
```{r}
full_df_highservice_treat_plot <- full_df[full_df$Services_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highservice_treat_plot = full_df_highservice_treat_plot[keeps]

full_df_highservice_treat_plot <- full_df_highservice_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highservice_treat_plot <- full_df_highservice_treat_plot[, col_order]

full_df_highservice_treat_plot <- colMeans(full_df_highservice_treat_plot) 

write.xlsx(full_df_highservice_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighService_Treat.xlsx")
```

##MSFT 2020 High Service Control
```{r}
full_df_highservice_control_plot <- full_df[full_df$Services_Below_0_Above_1== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highservice_control_plot = full_df_highservice_control_plot[keeps]

full_df_highservice_control_plot <- full_df_highservice_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highservice_control_plot <- full_df_highservice_control_plot[, col_order]

full_df_highservice_control_plot <- colMeans(full_df_highservice_control_plot) 

write.xlsx(full_df_highservice_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighService_Control.xlsx")
```

##MSFT 2020 Low Service Treat
```{r}
full_df_lowservice_treat_plot <- full_df[full_df$Services_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowservice_treat_plot = full_df_lowservice_treat_plot[keeps]

full_df_lowservice_treat_plot <- full_df_lowservice_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowservice_treat_plot <- full_df_lowservice_treat_plot[, col_order]

full_df_lowservice_treat_plot <- colMeans(full_df_lowservice_treat_plot) 

write.xlsx(full_df_lowservice_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowService_Treat.xlsx")
```

##MSFT 2020 Low Service Control
```{r}
full_df_lowservice_control_plot <- full_df[full_df$Services_Below_0_Above_1== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowservice_control_plot = full_df_lowservice_control_plot[keeps]

full_df_lowservice_control_plot <- full_df_lowservice_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowservice_control_plot <- full_df_lowservice_control_plot[, col_order]

full_df_lowservice_control_plot <- colMeans(full_df_lowservice_control_plot) 

write.xlsx(full_df_lowservice_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowService_Control.xlsx")
```

##MSFT 2020 High New Buildings Treat
```{r}
keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020", "11/1/2020", "12/1/2020")

full_df_highnewbuildings_treat_plot <- full_df[full_df$NewHouseUnits_Above1_Below0== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highnewbuildings_treat_plot = full_df_highnewbuildings_treat_plot[keeps]

full_df_highnewbuildings_treat_plot <- full_df_highnewbuildings_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highnewbuildings_treat_plot <- full_df_highnewbuildings_treat_plot[, col_order]

full_df_highnewbuildings_treat_plot <- colMeans(full_df_highnewbuildings_treat_plot) 

write.xlsx(full_df_highnewbuildings_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighNewBuildings_Treat.xlsx")
```

##MSFT 2020 High New Buildings Control
```{r}
full_df_highnewbuildings_control_plot <- full_df[full_df$NewHouseUnits_Above1_Below0== "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highnewbuildings_control_plot = full_df_highnewbuildings_control_plot[keeps]

full_df_highnewbuildings_control_plot <- full_df_highnewbuildings_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highnewbuildings_control_plot <- full_df_highnewbuildings_control_plot[, col_order]

full_df_highnewbuildings_control_plot <- colMeans(full_df_highnewbuildings_control_plot) 

write.xlsx(full_df_highnewbuildings_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighNewBuildings_Control.xlsx")
```

##MSFT 2020 Low Service Treat
```{r}
full_df_lownewbuildings_treat_plot <- full_df[full_df$NewHouseUnits_Above1_Below0== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lownewbuildings_treat_plot = full_df_lownewbuildings_treat_plot[keeps]

full_df_lownewbuildings_treat_plot <- full_df_lownewbuildings_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lownewbuildings_treat_plot <- full_df_lownewbuildings_treat_plot[, col_order]

full_df_lownewbuildings_treat_plot <- colMeans(full_df_lownewbuildings_treat_plot) 

write.xlsx(full_df_lownewbuildings_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowNewBuildings_Treat.xlsx")
```

##MSFT 2020 Low Service Control
```{r}
full_df_lownewbuildings_control_plot <- full_df[full_df$NewHouseUnits_Above1_Below0== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lownewbuildings_control_plot = full_df_lownewbuildings_control_plot[keeps]

full_df_lownewbuildings_control_plot <- full_df_lownewbuildings_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lownewbuildings_control_plot <- full_df_lownewbuildings_control_plot[, col_order]

full_df_lownewbuildings_control_plot <- colMeans(full_df_lownewbuildings_control_plot) 

write.xlsx(full_df_lownewbuildings_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowNewHousing_Control.xlsx")
```

##MSTT 2020 90/80/70/60/50 Bridges 

```{r}
keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020", "11/1/2020", "12/1/2020")

full_df_highbridges_treat_plot <- full_df[full_df$BridgeCount_Above1_Below0== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highbridges_treat_plot = full_df_highbridges_treat_plot[keeps]

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot[, col_order]

full_df_highbridges_treat_plot <- colMeans(full_df_highbridges_treat_plot) 

write.xlsx(full_df_highbridges_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighBridges_Treat.xlsx")
```


##MSFT 2020 High Bridges Treat
```{r}
keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020")

full_df_highbridges_treat_plot <- full_df[full_df$BridgeCount_Above1_Below0== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highbridges_treat_plot = full_df_highbridges_treat_plot[keeps]

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot[, col_order]

full_df_highbridges_treat_plot <- colMeans(full_df_highbridges_treat_plot) 

write.xlsx(full_df_highbridges_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighBridges_Treat.xlsx")
```

##MSFT 2020 High Bridges Control
```{r}
full_df_highbridges_control_plot <- full_df[full_df$BridgeCount_Above1_Below0 == "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highbridges_control_plot = full_df_highbridges_control_plot[keeps]

full_df_highbridges_control_plot <- full_df_highbridges_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highbridges_control_plot <- full_df_highbridges_control_plot[, col_order]

full_df_highbridges_control_plot <- colMeans(full_df_highbridges_control_plot) 

write.xlsx(full_df_highbridges_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighBridges_Control.xlsx")
```

##MSFT 2020 Low Bridges Treat
```{r}
keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020")

full_df_highbridges_treat_plot <- full_df[full_df$BridgeCount_Above1_Below0== "1" & full_df$msft_50_or_more_2020 == "1",]

full_df_highbridges_treat_plot = full_df_highbridges_treat_plot[keeps]

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highbridges_treat_plot <- full_df_highbridges_treat_plot[, col_order]

full_df_highbridges_treat_plot <- colMeans(full_df_highbridges_treat_plot) 

write.xlsx(full_df_highbridges_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighBridges_Treat.xlsx")
```

##MSFT 2020 High Bridges Control
```{r}
full_df_highbridges_control_plot <- full_df[full_df$BridgeCount_Above1_Below0 == "1" & full_df$msft_50_or_more_2020 == "0",]

full_df_highbridges_control_plot = full_df_highbridges_control_plot[keeps]

full_df_highbridges_control_plot <- full_df_highbridges_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_highbridges_control_plot <- full_df_highbridges_control_plot[, col_order]

full_df_highbridges_control_plot <- colMeans(full_df_highbridges_control_plot) 

write.xlsx(full_df_highbridges_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/HighBridges_Control.xlsx")
```


##MSFT 2020 Low Service Treat
```{r}
full_df_lowbridges_treat_plot <- full_df[full_df$BridgeCount_Above1_Below0== "0" & full_df$msft_50_or_more_2020 == "1",]

full_df_lowbridges_treat_plot = full_df_lowbridges_treat_plot[keeps]

full_df_lowbridges_treat_plot <- full_df_lowbridges_treat_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowbridges_treat_plot <- full_df_lowbridges_treat_plot[, col_order]

full_df_lowbridges_treat_plot <- colMeans(full_df_lowbridges_treat_plot) 

write.xlsx(full_df_lowbridges_treat_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowBridges_Treat.xlsx")
```

##MSFT 2020 Low Service Control
```{r}
full_df_lowbridges_control_plot <- full_df[full_df$BridgeCount_Above1_Below0== "0" & full_df$msft_50_or_more_2020 == "0",]

full_df_lowbridges_control_plot = full_df_lowbridges_control_plot[keeps]

full_df_lowbridges_control_plot <- full_df_lowbridges_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_lowbridges_control_plot <- full_df_lowbridges_control_plot[, col_order]

full_df_lowbridges_control_plot <- colMeans(full_df_lowbridges_control_plot) 

write.xlsx(full_df_lowbridges_control_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/LowBridges_Control.xlsx")

```


##Ookla 2020 Control
```{r}

keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")

col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020")

full_df_censustract_control_plot = full_df_censustract_control[keeps]

full_df_censustract_control_plot <- full_df_censustract_control_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_censustract_control_plot <- full_df_censustract_control_plot[, col_order]

full_df_censustract_control_plot <- colMeans(full_df_censustract_control_plot) 

```

##Ookla 2020 Treat = 75% CT with 50+ at County
```{r}

full_df_censustract_treatat75CT_plot = full_df_censustract_treatat75CT[keeps]

full_df_censustract_treatat75CT_plot <- na.omit(full_df_censustract_treatat75CT_plot)

full_df_censustract_treatat75CT_plot <- full_df_censustract_treatat75CT_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_censustract_treatat75CT_plot <- full_df_censustract_treatat75CT_plot[, col_order]

full_df_censustract_treatat75CT_plot <- colMeans(full_df_censustract_treatat75CT_plot)

write.xlsx(full_df_censustract_treatat75CT_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Ookla CT 75%.xlsx")

```

##Ookla 2020 Treat = 50% CT with 50+ at County
```{r}

full_df_censustract_treatat50CT_plot = full_df_censustract_treatat50CT[keeps]

full_df_censustract_treatat50CT_plot <- na.omit(full_df_censustract_treatat50CT_plot)

full_df_censustract_treatat50CT_plot <- full_df_censustract_treatat50CT_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_censustract_treatat50CT_plot <- full_df_censustract_treatat50CT_plot[, col_order]

full_df_censustract_treatat50CT_plot <- colMeans(full_df_censustract_treatat50CT_plot)

write.xlsx(full_df_censustract_treatat75CT_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Ookla CT 50%.xlsx")

```

##Ookla 2020 Treat = 40% CT with 50+ at County
```{r}

full_df_censustract_treatat40CT_plot = full_df_censustract_treatat40CT[keeps]

full_df_censustract_treatat40CT_plot <- na.omit(full_df_censustract_treatat40CT_plot)

full_df_censustract_treatat40CT_plot <- full_df_censustract_treatat40CT_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_censustract_treatat40CT_plot <- full_df_censustract_treatat40CT_plot[, col_order]

full_df_censustract_treatat40CT_plot <- colMeans(full_df_censustract_treatat40CT_plot)


write.xlsx(full_df_censustract_treatat75CT_plot, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Ookla CT 75%.xlsx")

```

##Ookla 2020 Treat = 25% CT with 50+ at County
```{r}

full_df_censustract_treatat25CT_plot = full_df_censustract_treatat25CT[keeps]

full_df_censustract_treatat25CT_plot <- na.omit(full_df_censustract_treatat25CT_plot)

full_df_censustract_treatat25CT_plot <- full_df_censustract_treatat25CT_plot %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_censustract_treatat25CT_plot <- full_df_censustract_treatat25CT_plot[, col_order]

full_df_censustract_treatat25CT_plot <- colMeans(full_df_censustract_treatat25CT_plot) 

```

##Bridges 2020 Treat
```{r}

keeps <- c("GEOID", "Period", "Unemployment_Rate_Percent")
col_order <- c("7/1/19", "8/1/19", "9/1/19","10/1/19", "11/1/2019", "12/1/2019", "1/1/2020", "2/1/2020", "3/1/2020", "4/1/2020", "5/1/2020", "6/1/2020", "7/1/2020", "8/1/2020", "9/1/2020", "10/1/2020")

full_df_treat_plot_bridges <- full_df[full_df$BridgeCount_Above1_Below0 == "1",]

full_df_treat_plot_bridges = full_df_treat_plot_bridges[keeps]

full_df_treat_plot_bridges <- na.omit(full_df_treat_plot_bridges)

full_df_treat_plot_bridges <- full_df_treat_plot_bridges %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_plot_bridges <- full_df_treat_plot_bridges[, col_order]

write.xlsx(full_df_treat_plot_bridges, "/Users/nikkivandenHeever/Desktop/Fixing Bridges.xlsx")

full_df_treat_plot_bridges <- colMeans(full_df_treat_plot_bridges) 

write.xlsx(full_df_treat_plot_bridges, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Bridges Treat.xlsx")

```

##Bridges 2020 Control
```{r}

full_df_control_plot_bridges <- full_df[full_df$BridgeCount_Above1_Below0 == "0",]

full_df_control_plot_bridges = full_df_control_plot_bridges[keeps]

#Need to come back to fix this 
write.xlsx(full_df_control_plot_bridges, "/Users/nikkivandenHeever/Desktop/Fixing Bridges.xlsx")

full_df_control_plot_bridges <- full_df_control_plot_bridges %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_control_plot_bridges <- full_df_control_plot_bridges[, col_order]

full_df_control_plot_bridges <- colMeans(full_df_control_plot_bridges) 

write.xlsx(full_df_control_plot_bridges, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Bridges Control.xlsx")
```

##Buildings 2020 Treat
```{r}
full_df_treat_plot_buildings <- full_df[full_df$NewHouseUnits_Above1_Below0 == "1",]

full_df_treat_plot_buildings = full_df_treat_plot_buildings[keeps]

full_df_treat_plot_buildings <- full_df_treat_plot_buildings %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_treat_plot_buildings <- full_df_treat_plot_buildings[, col_order]

full_df_treat_plot_buildings <- colMeans(full_df_treat_plot_buildings) 

write.xlsx(full_df_treat_plot_buildings, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Buildings Treat.xlsx")

```

##Buildings 2020 Control
```{r}
full_df_control_plot_buildings <- full_df[full_df$NewHouseUnits_Above1_Below0 == "0",]

full_df_control_plot_buildings = full_df_control_plot_buildings[keeps]

full_df_control_plot_buildings <- full_df_control_plot_buildings %>%
  pivot_wider(names_from = Period, values_from = Unemployment_Rate_Percent)

full_df_control_plot_buildings <- full_df_control_plot_buildings[, col_order]

full_df_control_plot_buildings <- colMeans(full_df_control_plot_buildings) 

write.xlsx(full_df_control_plot_buildings, "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Calcs/Parallel Trend Graphics/Buildlings Control.xlsx")
```

##Using Log

```{r}

full_df_log <- full_df

full_df_log$log_Unemployment_Rate_Percent <- log(full_df_log$Unemployment_Rate_Percent)

ols_2019msft_25_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2019msft_40_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2019msft_50_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2019msft_75_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)


tb1<- tbl_regression(ols_2019msft_25_unemployment_log, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_25_or_more_2019 ~ "Treat (25%, MSFT 2019)"))

tb2<- tbl_regression(ols_2019msft_40_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_40_or_more_2019 ~ "Treat (40%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019msft_50_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2019 ~ "Treat (50%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019msft_75_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_75_or_more_2019 ~ "Treat (75%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_MSFT <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT**", "**Treat = 40% Penetration, 2019 MSFT**", "**Treat = 50% Penetration, 2019 MSFT**", "**Treat = 75% Penetration, 2019 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2019_MSFT), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2019 MSFT LOG.png")

ols_2020msft_25_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2020 + COVID_0_Pre_1_Post*msft_25_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2020msft_40_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2020 + COVID_0_Pre_1_Post*msft_40_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2020msft_50_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

ols_2020msft_75_unemployment_log <- lm(log_Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2020 + COVID_0_Pre_1_Post*msft_75_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df_log)

tb1<- tbl_regression(ols_2020msft_25_unemployment_log, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_25_or_more_2020 ~ "Treat (25%, MSFT 2020)"))

tb2<- tbl_regression(ols_2020msft_40_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_40_or_more_2020 ~ "Treat (40%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2020msft_50_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2020 ~ "Treat (50%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2020msft_75_unemployment_log, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_75_or_more_2020 ~ "Treat (75%, MSFT 2020", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2020_MSFT <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2020 MSFT**", "**Treat = 40% Penetration, 2020 MSFT**", "**Treat = 50% Penetration, 2020 MSFT**", "**Treat = 75% Penetration, 2020 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2020_MSFT), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2020 MSFT LOG.png")

full_df_log$predicted_olsMSFT252019 <- predict(ols_2019msft_25_unemployment_log)   # Save the predicted values
full_df_log$residuals_olsMSFT252019 <- residuals(ols_2019msft_25_unemployment_log)   #Save the residual values

# set plot parameters

plot(full_df_log$predicted_olsMSFT252019,full_df_log$residuals_olsMSFT252019,
     ylab="Residuals", xlab="Log Wage",
     main="Mincer type model")

full_df_log$predicted_olsMSFT502020_log <- predict(ols_2020msft_50_unemployment_log)   # Save the predicted values
full_df_log$residuals_olsMSFT502020_log <- residuals(ols_2020msft_50_unemployment_log)   #Save the residual values

# set plot parameters

plot(full_df_log$predicted_olsMSFT502020_log,full_df_log$residuals_olsMSFT502020_log,
     ylab="Residuals", xlab="Log Wage",
     main="Mincer type model")

qqPlot(full_df_log$residuals_olsMSFT502020)
qqPlot(full_df_log$residuals_olsMSFT502020_log)
```

#Alaska Specific Analysis 
```{r}

full_df_AK <- full_df[full_df$State== "AK",]

#Starting regressions

ols_2019msft_25_unemployment <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_25_or_more_2019 + COVID_0_Pre_1_Post*msft_25_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df)

ols_2019msft_40_unemployment <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_40_or_more_2019 + COVID_0_Pre_1_Post*msft_40_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df)

ols_2019msft_50_unemployment <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2019 + COVID_0_Pre_1_Post*msft_50_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df)

ols_2019msft_75_unemployment <- lm(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_75_or_more_2019 + COVID_0_Pre_1_Post*msft_75_or_more_2019 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, data = full_df)


tb1<- tbl_regression(ols_2019msft_25_unemployment, label=list(ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic", COVID_0_Pre_1_Post ~ "Post COVID", msft_25_or_more_2019 ~ "Treat (25%, MSFT 2019)"))

tb2<- tbl_regression(ols_2019msft_40_unemployment, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_40_or_more_2019 ~ "Treat (40%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb3<- tbl_regression(ols_2019msft_50_unemployment, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_50_or_more_2019 ~ "Treat (50%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))

tb4<- tbl_regression(ols_2019msft_75_unemployment, label=list(COVID_0_Pre_1_Post ~ "Post COVID", msft_75_or_more_2019 ~ "Treat (75%, MSFT 2019", ed_growth_rate ~ "Growth Rate Pop 25+ w/ BS", percent_ed ~ "% Pop 25+ w/ BS", log_pop_density ~ "Log of Pop Density", percent_black ~ "% Pop Black", percent_asian ~ "% Pop Asian", percent_natamerican ~ "% Pop Native American", percent_hispanic ~ "% Pop Hispanic"))


tbl_merge_2019_MSFT <-
  tbl_merge(
    tbls = list(tb1, tb2, tb3, tb4),
    tab_spanner = c("**Treat = 25% Penetration, 2019 MSFT**", "**Treat = 40% Penetration, 2019 MSFT**", "**Treat = 50% Penetration, 2019 MSFT**", "**Treat = 75% Penetration, 2019 MSFT**"))

gt::gtsave(as_gt(tbl_merge_2019_MSFT), file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/2021/Quals/Part A Paper/Drafts/Regression Tables/Regression Unempl 2019 MSFT.png")

```


#Matching
```{r}

#Running t-tests on data before matching
full_df_preCOVID <- full_df[full_df$COVID_0_Pre_1_Post== "0",]

t_test_full <- t.test(full_df_preCOVID$Unemployment_Rate_Percent ~ full_df_preCOVID$msft_50_or_more_2020)

keeps <- c("Time", "Unemployment_Rate_Percent", "msft_50_or_more_2020", "msft_25_or_more_2020", "msft_40_or_more_2020", "msft_75_or_more_2020", "COVID_0_Pre_1_Post", "ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican", "state")

matching = full_df[keeps]

matching_short <- matching %>% na.omit()

#Running the Match MSFT 50% Penetration Simplified Set
matched_2020msft_50 <- matchit(msft_50_or_more_2020 ~ ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican,
                 data = matching_short,
                 method = 'cem', 
                 estimand = 'ATE')

matched_df_2020msft_50 <- match.data(matched_2020msft_50) %>% arrange(subclass, msft_50_or_more_2020)

matching_2020msft_50_simple <- lm_robust(Unemployment_Rate_Percent ~ msft_50_or_more_2020 + COVID_0_Pre_1_Post + msft_50_or_more_2020*COVID_0_Pre_1_Post + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, 
  clusters = state, 
  data = matched_df_2020msft_50, 
  weights = weights)

comp1 <- comparisons(matching_2020msft_50_simple,
                     variables = "msft_50_or_more_2020",
                     vcov = ~subclass,
                     newdata = subset(matched_df_2020msft_50, msft_50_or_more_2020 == 1),
                     wts = "weights")
summary(comp1)

fit1 <- lm(Y_C ~ A * (X1 + X2 + X3 + X4 + X5 + 
                        X6 + X7 + X8 + X9),
           data = md, weights = weights)


#Running the Match MSFT 50% Penetration
matching_2020msft_50 <- lm_robust(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican, clusters = state, data = matched_df_2020msft_50, weights = weights)

tb1 <-
  matching_2020msft_50_simple %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)

tb2 <-
  matching_2020msft_50 %>% 
  tbl_regression(estimate_fun = purrr::partial(style_ratio, digits = 2),) %>%
  add_glance_table(include = c(adj.r.squared, nobs)) %>%
  add_significance_stars(
    hide_se = TRUE,
    pattern = "{estimate}{stars}<br>({std.error})"
  ) %>%
  modify_header(estimate ~ "**Beta (SE)**") %>%
  modify_footnote(estimate ~ "SE = Standard Error", abbreviation = TRUE)


tbl_merge_2020_MSFT_Matching <- tbl_merge(
  list(tb1, tb2),
  tab_spanner = c("**Treat = 50% Penetration, 2020 MSFT Matched**", "**Treat = 50% Penetration, 2020 MSFT Matched**")) %>%
  modify_table_body(~.x %>% arrange(row_type == "glance_statistic")) %>%
  as_gt() %>%
  gt::tab_source_note(gt::md("*Coarsened Exact Matching (CEM) regression results. Robust standard errors are clustered at the state level. P-values are two-tailed.*")) %>%
  gt::tab_header(title = "2020 MSFT", subtitle = "Using CEM")

gt::gtsave(tbl_merge_2020_MSFT_Matching, file = "/Users/nikkivandenHeever/Documents/Documents/1_School/1_Carnegie Mellon/Research/2020-2022 NSF Rapid/Writing/For Nature Journal/Final Regression Tables/2020 MSFT Matched.png")


##Come back to this 
coeftest(model1, vcov. = vcovCL, cluster = ~subclass)

s.out <- summary(match2, standardize = TRUE)
plot(s.out)

match2$match.matrix

library(MatchIt)
data("lalonde", package = "MatchIt") #note, different from lalonde in Matching

m.out <- matchit(treat ~ age + educ + race + married + nodegree + re74 + re75,
                 data = lalonde, method = "cem", k2k = TRUE, 
                 ratio = 5)

m.out1 <- matchit(treat ~ age + race + married + educ, data = lalonde,
                  method = "cem", cutpoints = list(educ = 5),
                  grouping = list(race = list(c("white", "hispan"),
                                              c("black"))))
m.out1
summary(m.out1)

m.out2 <- matchit(msft_50_or_more_2020 ~  percent_ed + log_pop_density + percent_black,
                  data = matching_bb_demo_did_short,
                  method = "cem")
m.out2
summary(m.out2)

m.out3 <- matchit(msft_50_or_more_2020 ~ log_pop_density + percent_black,
                  data = matching_bb_demo_did_short_black_popdensity,
                  method = "cem", k2k = TRUE)
m.out3
summary(m.out3)

m.out3$match.matrix
  
```

#Synthetic Controls

````{r}

keeps <- c( "GEOID", "Time", "COVID_0_Pre_1_Post", "Unemployment_Rate_Percent", "msft_50_or_more_2020", "msft_25_or_more_2020", "msft_40_or_more_2020", "msft_75_or_more_2020", "ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican")

syntheticcontrol_did = full_df[keeps]

syntheticcontrol_did$GEOID <- as.numeric(syntheticcontrol_did$GEOID)

#Dropping any rows with missing data 
syntheticcontrol_did <- syntheticcontrol_did %>% na.omit()

syntheticcontrol_did$treatcontrol <- syntheticcontrol_did$msft_50_or_more_2020 * syntheticcontrol_did$COVID_0_Pre_1_Post

panelview(Unemployment_Rate_Percent ~ treatcontrol, data = syntheticcontrol_did,  index = c("GEOID","Time"), pre.post=TRUE) 

panelview(Unemployment_Rate_Percent ~ treatcontrol, data = syntheticcontrol_did,  index = c("GEOID","Time"), type = "outcome") 

keeps <- c("GEOID", "Time", "Unemployment_Rate_Percent", "msft_50_or_more_2020", "COVID_0_Pre_1_Post", "treatcontrol", "ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican")

df_summary = syntheticcontrol_did[keeps]


system.time(
    out <- gsynth(Unemployment_Rate_Percent ~ treatcontrol, data = df_summary, 
                  index = c("GEOID","Time"), force = "two-way", 
                  CV = TRUE, r = c(0, 5), se = TRUE, 
                  inference = "parametric", nboots = 1000, 
                  parallel = FALSE))
print(out)

plot(out)

plot(out, type = "raw")

plot(out, type = "counterfactual", raw = "none", main="")

plot(out, type = "counterfactual", raw = "band", 
     xlab = "Time")

plot(out, type = "counterfactual", raw = "all")

plot(out, type = "loadings")

summary(out)


```

```{r}

#Replicating: 

#Total units:3,143 (As of the 2020 census)
#Treated units (for MSFT 2020, 50% penetration):
bb_noNAs <- bbv %>% na.omit()
#Control units (for MSFT 2020, 50% penetration):
#Time periods: 18 (Starts July 2019, ends December 2020)
#Treatment kicks in at period 9 for all treated units, hence, a multi-period DID set up.

##########################
## Table 2
##########################

## interFE is a function in the gsynth package that implements
## interactive fixed effects models, of which additive fixed effects
## models are special case (when r = 0).

## Column 1 (DID)
out.did1<-interFE(Unemployment_Rate_Percent ~ treatcontrol,
                  data = syntheticcontrol_did, index =c("GEOID","Time"),
                  r = 0, force="none", nboots = 2000,
                  seed = 2139)

## Column 2 (DID)
out.did2<-interFE(Unemployment_Rate_Percent ~ COVID_0_Pre_1_Post + msft_50_or_more_2020 + COVID_0_Pre_1_Post*msft_50_or_more_2020 + ed_growth_rate + percent_ed + log_pop_density + percent_black + percent_hispanic + percent_asian + percent_natamerican,
                  data = syntheticcontrol_did, index = c("GEOID","Time"),
                  r = 0, force="none", nboots = 2000,
                  seed = 2139)

## Column 3 (GSC)
out.syn1<-gsynth(Unemployment_Rate_Percent ~ treatcontrol,
                 data = syntheticcontrol_did, index =c("GEOID","Time"),
                 force = "none", CV = TRUE, r=c(0,5), se = TRUE,
                 parallel = FALSE, nboots=2000, seed = 2139)

## Column 4 (GSC)
out.syn2<-gsynth(Unemployment_Rate_Percent ~ treatcontrol,
                 data = syntheticcontrol_did, index =c("GEOID","Time"),
                 force = "none", CV = TRUE, r=c(0,5), se = TRUE,
                 parallel = FALSE, nboots=2000, seed = 2139)


```

#Bayesian Causal Inference with Time-Series Cross-Sectional Data
```{r}
devtools::install_github('liulch/bpCausal')

out_bpCausal_1 <- bpCausal(data = syntheticcontrol_did, ## simulated dataset  
                 index =c("GEOID","Time"), ## names for unit and time index
                 Yname = "Unemployment_Rate_Percent", ## outcome variable
                 Dname = "treatcontrol", ## treatment indicator  
                 Xname = c("ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican"), # covariates that have constant (fixed) effect
                 Zname = c(), # covariates that have unit-level random effect  
                 Aname = c(), # covariates that have time-level random effect 
                 re = "none")   # two-way random effect: choose from ("unit", "time", "none", "both"


out_bpCausal_1 <- bpCausal(data = syntheticcontrol_did, ## simulated dataset  
                 index = c("GEOID","Time"), ## names for unit and time index
                 Yname = "Unemployment_Rate_Percent", ## outcome variable
                 Dname = "treatcontrol", ## treatment indicator  
                 Xname = c("ed_growth_rate", "percent_ed", "log_pop_density", "percent_black", "percent_hispanic", "percent_asian", "percent_natamerican"), # covariates that have constant (fixed) effect  
                 Zname = NULL, # covariates that have unit-level random effect  
                 Aname = NULL, # covariates that have time-level random effect  
                 re = "none",   # two-way random effect: choose from ("unit", "time", "none", "both")
                 r = 10,        # factor numbers 
                 niter = 15000, # number of mcmc draws
                 burn = 5000,   # burn-in draws 
                 xlasso = 1,    ## whether to shrink constant coefs (1 = TRUE, 0 = FALSE)
                 zlasso = 1,    ## whether to shrink unit-level random coefs (1 = TRUE, 0 = FALSE)
                 alasso = 1,    ## whether to shrink time-level coefs (1 = TRUE, 0 = FALSE)
                 flasso = 1,    ## whether to shrink factor loadings (1 = TRUE, 0 = FALSE)
                 a1 = 0.001, a2 = 0.001, ## parameters for hyper prior shrink on beta (diffuse hyper priors)
                 b1 = 0.001, b2 = 0.001, ## parameters for hyper prior shrink on alpha_i
                 c1 = 0.001, c2 = 0.001, ## parameters for hyper prior shrink on xi_t
                 p1 = 0.001, p2 = 0.001) ## parameters for hyper prior shrink on factor terms

sout1 <- coefSummary(out_bpCausal_1)  ## summary estimated parameters

sout1$est.beta 


eout1 <- effSummary(out_bpCausal_1,   ## summary treatment effects
                    usr.id = NULL, ## treatment effect for individual treated units, if input NULL, calculate average TT
                    cumu = FALSE,  ## whether to calculate culmulative treatment effects
                    rela.period = TRUE) ## whether to use time relative to the occurence of treatment (1 is the first post-treatment period) or real period (like year 1998, 1999, ...)
eout1$est.eff

eout1$est.avg


````
